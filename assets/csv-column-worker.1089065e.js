var bh=Object.defineProperty;var wh=(K,ee,_)=>ee in K?bh(K,ee,{enumerable:!0,configurable:!0,writable:!0,value:_}):K[ee]=_;var f=(K,ee,_)=>(wh(K,typeof ee!="symbol"?ee+"":ee,_),_);(function(){"use strict";var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ee={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(K,function(){var r=1e3,s=6e4,n=36e5,a="millisecond",i="second",o="minute",l="hour",u="day",h="week",c="month",p="quarter",m="year",g="date",T="Invalid Date",B=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,j=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,$={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(w){var v=["th","st","nd","rd"],d=w%100;return"["+w+(v[(d-20)%10]||v[d]||v[0])+"]"}},N=function(w,v,d){var M=String(w);return!M||M.length>=v?w:""+Array(v+1-M.length).join(d)+w},se={s:N,z:function(w){var v=-w.utcOffset(),d=Math.abs(v),M=Math.floor(d/60),y=d%60;return(v<=0?"+":"-")+N(M,2,"0")+":"+N(y,2,"0")},m:function w(v,d){if(v.date()<d.date())return-w(d,v);var M=12*(d.year()-v.year())+(d.month()-v.month()),y=v.clone().add(M,c),A=d-y<0,x=v.clone().add(M+(A?-1:1),c);return+(-(M+(d-y)/(A?y-x:x-y))||0)},a:function(w){return w<0?Math.ceil(w)||0:Math.floor(w)},p:function(w){return{M:c,y:m,w:h,d:u,D:g,h:l,m:o,s:i,ms:a,Q:p}[w]||String(w||"").toLowerCase().replace(/s$/,"")},u:function(w){return w===void 0}},P="en",U={};U[P]=$;var Me=function(w){return w instanceof nt},pe=function w(v,d,M){var y;if(!v)return P;if(typeof v=="string"){var A=v.toLowerCase();U[A]&&(y=A),d&&(U[A]=d,y=A);var x=v.split("-");if(!y&&x.length>1)return w(x[0])}else{var E=v.name;U[E]=v,y=E}return!M&&y&&(P=y),y||!M&&P},L=function(w,v){if(Me(w))return w.clone();var d=typeof v=="object"?v:{};return d.date=w,d.args=arguments,new nt(d)},F=se;F.l=pe,F.i=Me,F.w=function(w,v){return L(w,{locale:v.$L,utc:v.$u,x:v.$x,$offset:v.$offset})};var nt=function(){function w(d){this.$L=pe(d.locale,null,!0),this.parse(d)}var v=w.prototype;return v.parse=function(d){this.$d=function(M){var y=M.date,A=M.utc;if(y===null)return new Date(NaN);if(F.u(y))return new Date;if(y instanceof Date)return new Date(y);if(typeof y=="string"&&!/Z$/i.test(y)){var x=y.match(B);if(x){var E=x[2]-1||0,Y=(x[7]||"0").substring(0,3);return A?new Date(Date.UTC(x[1],E,x[3]||1,x[4]||0,x[5]||0,x[6]||0,Y)):new Date(x[1],E,x[3]||1,x[4]||0,x[5]||0,x[6]||0,Y)}}return new Date(y)}(d),this.$x=d.x||{},this.init()},v.init=function(){var d=this.$d;this.$y=d.getFullYear(),this.$M=d.getMonth(),this.$D=d.getDate(),this.$W=d.getDay(),this.$H=d.getHours(),this.$m=d.getMinutes(),this.$s=d.getSeconds(),this.$ms=d.getMilliseconds()},v.$utils=function(){return F},v.isValid=function(){return this.$d.toString()!==T},v.isSame=function(d,M){var y=L(d);return this.startOf(M)<=y&&y<=this.endOf(M)},v.isAfter=function(d,M){return L(d)<this.startOf(M)},v.isBefore=function(d,M){return this.endOf(M)<L(d)},v.$g=function(d,M,y){return F.u(d)?this[M]:this.set(y,d)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(d,M){var y=this,A=!!F.u(M)||M,x=F.p(d),E=function(ke,W){var ce=F.w(y.$u?Date.UTC(y.$y,W,ke):new Date(y.$y,W,ke),y);return A?ce:ce.endOf(u)},Y=function(ke,W){return F.w(y.toDate()[ke].apply(y.toDate("s"),(A?[0,0,0,0]:[23,59,59,999]).slice(W)),y)},C=this.$W,V=this.$M,fe=this.$D,ue="set"+(this.$u?"UTC":"");switch(x){case m:return A?E(1,0):E(31,11);case c:return A?E(1,V):E(0,V+1);case h:var Le=this.$locale().weekStart||0,Re=(C<Le?C+7:C)-Le;return E(A?fe-Re:fe+(6-Re),V);case u:case g:return Y(ue+"Hours",0);case l:return Y(ue+"Minutes",1);case o:return Y(ue+"Seconds",2);case i:return Y(ue+"Milliseconds",3);default:return this.clone()}},v.endOf=function(d){return this.startOf(d,!1)},v.$set=function(d,M){var y,A=F.p(d),x="set"+(this.$u?"UTC":""),E=(y={},y[u]=x+"Date",y[g]=x+"Date",y[c]=x+"Month",y[m]=x+"FullYear",y[l]=x+"Hours",y[o]=x+"Minutes",y[i]=x+"Seconds",y[a]=x+"Milliseconds",y)[A],Y=A===u?this.$D+(M-this.$W):M;if(A===c||A===m){var C=this.clone().set(g,1);C.$d[E](Y),C.init(),this.$d=C.set(g,Math.min(this.$D,C.daysInMonth())).$d}else E&&this.$d[E](Y);return this.init(),this},v.set=function(d,M){return this.clone().$set(d,M)},v.get=function(d){return this[F.p(d)]()},v.add=function(d,M){var y,A=this;d=Number(d);var x=F.p(M),E=function(V){var fe=L(A);return F.w(fe.date(fe.date()+Math.round(V*d)),A)};if(x===c)return this.set(c,this.$M+d);if(x===m)return this.set(m,this.$y+d);if(x===u)return E(1);if(x===h)return E(7);var Y=(y={},y[o]=s,y[l]=n,y[i]=r,y)[x]||1,C=this.$d.getTime()+d*Y;return F.w(C,this)},v.subtract=function(d,M){return this.add(-1*d,M)},v.format=function(d){var M=this,y=this.$locale();if(!this.isValid())return y.invalidDate||T;var A=d||"YYYY-MM-DDTHH:mm:ssZ",x=F.z(this),E=this.$H,Y=this.$m,C=this.$M,V=y.weekdays,fe=y.months,ue=function(W,ce,Ut,at){return W&&(W[ce]||W(M,A))||Ut[ce].slice(0,at)},Le=function(W){return F.s(E%12||12,W,"0")},Re=y.meridiem||function(W,ce,Ut){var at=W<12?"AM":"PM";return Ut?at.toLowerCase():at},ke={YY:String(this.$y).slice(-2),YYYY:this.$y,M:C+1,MM:F.s(C+1,2,"0"),MMM:ue(y.monthsShort,C,fe,3),MMMM:ue(fe,C),D:this.$D,DD:F.s(this.$D,2,"0"),d:String(this.$W),dd:ue(y.weekdaysMin,this.$W,V,2),ddd:ue(y.weekdaysShort,this.$W,V,3),dddd:V[this.$W],H:String(E),HH:F.s(E,2,"0"),h:Le(1),hh:Le(2),a:Re(E,Y,!0),A:Re(E,Y,!1),m:String(Y),mm:F.s(Y,2,"0"),s:String(this.$s),ss:F.s(this.$s,2,"0"),SSS:F.s(this.$ms,3,"0"),Z:x};return A.replace(j,function(W,ce){return ce||ke[W]||x.replace(":","")})},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(d,M,y){var A,x=F.p(M),E=L(d),Y=(E.utcOffset()-this.utcOffset())*s,C=this-E,V=F.m(this,E);return V=(A={},A[m]=V/12,A[c]=V,A[p]=V/3,A[h]=(C-Y)/6048e5,A[u]=(C-Y)/864e5,A[l]=C/n,A[o]=C/s,A[i]=C/r,A)[x]||C,y?V:F.a(V)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return U[this.$L]},v.locale=function(d,M){if(!d)return this.$L;var y=this.clone(),A=pe(d,M,!0);return A&&(y.$L=A),y},v.clone=function(){return F.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},w}(),Qr=nt.prototype;return L.prototype=Qr,[["$ms",a],["$s",i],["$m",o],["$H",l],["$W",u],["$M",c],["$y",m],["$D",g]].forEach(function(w){Qr[w[1]]=function(v){return this.$g(v,w[0],w[1])}}),L.extend=function(w,v){return w.$i||(w(v,nt,L),w.$i=!0),L},L.locale=pe,L.isDayjs=Me,L.unix=function(w){return L(1e3*w)},L.en=U[P],L.Ls=U,L.p={},L})})(ee);var _=ee.exports;function it(e,t){let r=!1;typeof e.v=="string"&&(e.v=parseFloat(e.v));let s=e.v;return e.is=="gt"?r=t>s:e.is=="lt"?r=t<s:e.is=="lte"?r=t<=s:e.is=="gte"?r=t>=s:e.is=="eq"&&(r=t==s),r}function es(e,t,r){let s={true:!1,next:!0,score:0};switch(e.if){case"hour":let n=new Date(r).getHours();s.true=it(e,n);break;case"month":let a=parseInt(_(r).format("DD"));s.true=it(e,a);break;case"value":typeof t=="string"&&(t=parseFloat(t)),s.true=it(e,t);break}return s.next=!s.true,s.score=e.sc,s}function Ue(e,t,r){let s=0;if(t.score&&!t.score_calc)s=parseInt(`${t.score}`);else if(t.score_calc){let a=t.score_calc.map(i=>es(i,e,r)).filter(i=>i.true);s=a.length?parseFloat(`${a[0].score}`):s}return s}const ts=e=>{const t=e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g);return t?t.join("_").toLowerCase():""};var Vt={exports:{}};(function(e,t){(function(r,s){e.exports=s()})(K,function(){return function(r,s,n){r=r||{};var a=s.prototype,i={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function o(u,h,c,p){return a.fromToBase(u,h,c,p)}n.en.relativeTime=i,a.fromToBase=function(u,h,c,p,m){for(var g,T,B,j=c.$locale().relativeTime||i,$=r.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],N=$.length,se=0;se<N;se+=1){var P=$[se];P.d&&(g=p?n(u).diff(c,P.d,!0):c.diff(u,P.d,!0));var U=(r.rounding||Math.round)(Math.abs(g));if(B=g>0,U<=P.r||!P.r){U<=1&&se>0&&(P=$[se-1]);var Me=j[P.l];m&&(U=m(""+U)),T=typeof Me=="string"?Me.replace("%d",U):Me(U,h,P.l,B);break}}if(h)return T;var pe=B?j.future:j.past;return typeof pe=="function"?pe(T):pe.replace("%s",T)},a.to=function(u,h){return o(u,h,this,!0)},a.from=function(u,h){return o(u,h,this)};var l=function(u){return u.$u?n.utc():n()};a.toNow=function(u){return this.to(l(this),u)},a.fromNow=function(u){return this.from(l(this),u)}}})})(Vt);var rs=Vt.exports;_.extend(rs);var ss={toId(e){return[e.getTime().toString(16),Math.random().toString().substr(3,8)].join(".")},fromId(e){try{const t=e.split(".");return new Date(parseInt(t[0],16))}catch(t){throw t}},padTime(e){return(e+"").length===1?(e+"").padStart(2,"0"):e},isToday(e){return new Date().toDateString()===e.toDateString()},isSameDay(e,t){return e&&t?e.toDateString()===t.toDateString():!1},secondsToTime(e){e=e||0;let t=e,r=Math.floor(parseInt(`${t}`)/60).toString(),s;return parseInt(r)>59&&(s=Math.floor(parseInt(r)/60).toString(),r=(parseInt(r)-parseInt(s)*60).toString()),t=Math.floor(parseInt(`${t}`)%60),r=r,s?(s=parseInt(`${s}`),`${this.padTime(s)}:${this.padTime(r)}:${this.padTime(t)}`):`00:${this.padTime(r)}:${this.padTime(t)}`},dateToDesc(e){let t=_(e),r=parseInt(t.format("H"));return r>=6&&r<12?"morning":r>=12&&r<18?"afternoon":r>=18&&r<20?"evening":"night"},fromNow(e,t=!0){let r=_(e).fromNow(),s=r;return r=="a few seconds ago"?s="now":s=s.replace("minutes","min").replace("seconds","sec").replace("months","mon").replace("hours","hrs"),t||(s=s.replace("ago","").trim()),s},datetimeLocal(e){let t=e.split("T"),r=t[0],s=t[1];return _(r,"YYYY-MM-DD").set("hour",parseFloat(s.split(":")[0])).set("minute",parseFloat(s.split(":")[1])).toDate()},msToSecond(e){return e/1e3},timestringToSeconds(e){let t=e.split(":");return this.unitsToSeconds(t[0],t[1],t[2])},unitsToSeconds(e,t,r){let s=0;return s=(parseInt(e)||0)*60*60,s=s+(parseInt(t)||0)*60,s=s+(parseInt(r)||0),s},getNumberedArray(e){e++;let t=[];for(var r=0;r<e;r++)t.push((r+"").toString().length==1?`0${r}`:`${r}`);return t},toggleAMPM(e){let t=_(e),r=t.format("a"),s=parseInt(t.format("H"));return r=="am"&&s!==12?t.add(12,"hour").toDate():r=="pm"&&s!==12?t.subtract(12,"hour").toDate():t.toDate()},getDateFormat(e="md",t,r=!1){let s="";switch(e){case"xs":s=t=="imperial"?"M/D/YY":"D/M/YY";break;case"sm":s=t=="imperial"?"MM/DD/YYYY":"DD/MM/YYYY";break;case"md":s=t=="imperial"?"MMM D YYYY":"D MMM YYYY";break;case"lg":s=t=="imperial"?"MMM Do YYYY":"Do MMM YYYY";break;case"xl":s=t=="imperial"?"ddd MMM Do YYYY":"ddd Do MMM YYYY";break}return r?s.replace(/(YYYY|YY)/,""):s},getTimeFormat(e="md",t){switch(e){case"xs":return t=="imperial"?"ha":"H:mm";case"sm":return t=="imperial"?"h:mma":"HH:mm";default:return t=="imperial"?"h:mm a":"HH:mm"}},calendarMap:ot,getWeekOfMonth:Ht,dateToWeekString:ns};function ot(e,t,r="day"){const s=_(e).startOf(r),n=_(t).endOf(r),a=Math.abs(n.startOf(r).diff(s,r))+1;return Array(a).fill(0).map(({},i)=>({date:s.add(i,r).toDate()}))}function Ht(e){let t=e.getDate()+e.getDay();return parseInt(["0","1","2","3","4","5"][0|t/7])+1}function ns(e){return`${_(e).format("YYYY-MM")}-w${Ht(e)}`}const as={hour:{keyFormat:"YYYY-MM-DD-HH"},day:{keyFormat:"YYYY-MM-DD"},week:{keyFormat:"YYYY-MM-DD-w"},month:{keyFormat:"YYYY-MM"},quarter:{keyFormat:"YYYY-MM"},year:{keyFormat:"YYYY"}};var Z="INUMBER",xe="IOP1",Ae="IOP2",De="IOP3",ne="IVAR",de="IVARNAME",$e="IFUNCALL",Ve="IFUNDEF",z="IEXPR",ut="IEXPREVAL",ye="IMEMBER",He="IENDSTATEMENT",_e="IARRAY";function D(e,t){this.type=e,this.value=t!=null?t:0}D.prototype.toString=function(){switch(this.type){case Z:case xe:case Ae:case De:case ne:case de:case He:return this.value;case $e:return"CALL "+this.value;case Ve:return"DEF "+this.value;case _e:return"ARRAY "+this.value;case ye:return"."+this.value;default:return"Invalid Instruction"}};function Ge(e){return new D(xe,e)}function ae(e){return new D(Ae,e)}function Gt(e){return new D(De,e)}function lt(e,t,r,s,n){for(var a=[],i=[],o,l,u,h,c=0;c<e.length;c++){var p=e[c],m=p.type;if(m===Z||m===de)Array.isArray(p.value)?a.push.apply(a,lt(p.value.map(function(g){return new D(Z,g)}).concat(new D(_e,p.value.length)),t,r,s,n)):a.push(p);else if(m===ne&&n.hasOwnProperty(p.value))p=new D(Z,n[p.value]),a.push(p);else if(m===Ae&&a.length>1)l=a.pop(),o=a.pop(),h=r[p.value],p=new D(Z,h(o.value,l.value)),a.push(p);else if(m===De&&a.length>2)u=a.pop(),l=a.pop(),o=a.pop(),p.value==="?"?a.push(o.value?l.value:u.value):(h=s[p.value],p=new D(Z,h(o.value,l.value,u.value)),a.push(p));else if(m===xe&&a.length>0)o=a.pop(),h=t[p.value],p=new D(Z,h(o.value)),a.push(p);else if(m===z){for(;a.length>0;)i.push(a.shift());i.push(new D(z,lt(p.value,t,r,s,n)))}else if(m===ye&&a.length>0)o=a.pop(),a.push(new D(Z,o.value[p.value]));else{for(;a.length>0;)i.push(a.shift());i.push(p)}}for(;a.length>0;)i.push(a.shift());return i}function qt(e,t,r){for(var s=[],n=0;n<e.length;n++){var a=e[n],i=a.type;if(i===ne&&a.value===t)for(var o=0;o<r.tokens.length;o++){var l=r.tokens[o],u;l.type===xe?u=Ge(l.value):l.type===Ae?u=ae(l.value):l.type===De?u=Gt(l.value):u=new D(l.type,l.value),s.push(u)}else i===z?s.push(new D(z,qt(a.value,t,r))):s.push(a)}return s}function ve(e,t,r){var s=[],n,a,i,o,l,u;if(ht(e))return ie(e,r);for(var h=e.length,c=0;c<h;c++){var p=e[c],m=p.type;if(m===Z||m===de)s.push(p.value);else if(m===Ae)a=s.pop(),n=s.pop(),p.value==="and"?s.push(n?!!ve(a,t,r):!1):p.value==="or"?s.push(n?!0:!!ve(a,t,r)):p.value==="="?(o=t.binaryOps[p.value],s.push(o(n,ve(a,t,r),r))):(o=t.binaryOps[p.value],s.push(o(ie(n,r),ie(a,r))));else if(m===De)i=s.pop(),a=s.pop(),n=s.pop(),p.value==="?"?s.push(ve(n?a:i,t,r)):(o=t.ternaryOps[p.value],s.push(o(ie(n,r),ie(a,r),ie(i,r))));else if(m===ne)if(p.value in t.functions)s.push(t.functions[p.value]);else if(p.value in t.unaryOps&&t.parser.isOperatorEnabled(p.value))s.push(t.unaryOps[p.value]);else{var g=r[p.value];if(g!==void 0)s.push(g);else throw new Error("undefined variable: "+p.value)}else if(m===xe)n=s.pop(),o=t.unaryOps[p.value],s.push(o(ie(n,r)));else if(m===$e){for(u=p.value,l=[];u-- >0;)l.unshift(ie(s.pop(),r));if(o=s.pop(),o.apply&&o.call)s.push(o.apply(void 0,l));else throw new Error(o+" is not a function")}else if(m===Ve)s.push(function(){for(var T=s.pop(),B=[],j=p.value;j-- >0;)B.unshift(s.pop());var $=s.pop(),N=function(){for(var se=Object.assign({},r),P=0,U=B.length;P<U;P++)se[B[P]]=arguments[P];return ve(T,t,se)};return Object.defineProperty(N,"name",{value:$,writable:!1}),r[$]=N,N}());else if(m===z)s.push(is(p,t));else if(m===ut)s.push(p);else if(m===ye)n=s.pop(),s.push(n[p.value]);else if(m===He)s.pop();else if(m===_e){for(u=p.value,l=[];u-- >0;)l.unshift(s.pop());s.push(l)}else throw new Error("invalid Expression")}if(s.length>1)throw new Error("invalid Expression (parity)");return s[0]===0?0:ie(s[0],r)}function is(e,t,r){return ht(e)?e:{type:ut,value:function(s){return ve(e.value,t,s)}}}function ht(e){return e&&e.type===ut}function ie(e,t){return ht(e)?e.value(t):e}function pt(e,t){for(var r=[],s,n,a,i,o,l,u=0;u<e.length;u++){var h=e[u],c=h.type;if(c===Z)typeof h.value=="number"&&h.value<0?r.push("("+h.value+")"):Array.isArray(h.value)?r.push("["+h.value.map(zt).join(", ")+"]"):r.push(zt(h.value));else if(c===Ae)n=r.pop(),s=r.pop(),i=h.value,t?i==="^"?r.push("Math.pow("+s+", "+n+")"):i==="and"?r.push("(!!"+s+" && !!"+n+")"):i==="or"?r.push("(!!"+s+" || !!"+n+")"):i==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+s+"),("+n+")))"):i==="=="?r.push("("+s+" === "+n+")"):i==="!="?r.push("("+s+" !== "+n+")"):i==="["?r.push(s+"[("+n+") | 0]"):r.push("("+s+" "+i+" "+n+")"):i==="["?r.push(s+"["+n+"]"):r.push("("+s+" "+i+" "+n+")");else if(c===De)if(a=r.pop(),n=r.pop(),s=r.pop(),i=h.value,i==="?")r.push("("+s+" ? "+n+" : "+a+")");else throw new Error("invalid Expression");else if(c===ne||c===de)r.push(h.value);else if(c===xe)s=r.pop(),i=h.value,i==="-"||i==="+"?r.push("("+i+s+")"):t?i==="not"?r.push("(!"+s+")"):i==="!"?r.push("fac("+s+")"):r.push(i+"("+s+")"):i==="!"?r.push("("+s+"!)"):r.push("("+i+" "+s+")");else if(c===$e){for(l=h.value,o=[];l-- >0;)o.unshift(r.pop());i=r.pop(),r.push(i+"("+o.join(", ")+")")}else if(c===Ve){for(n=r.pop(),l=h.value,o=[];l-- >0;)o.unshift(r.pop());s=r.pop(),t?r.push("("+s+" = function("+o.join(", ")+") { return "+n+" })"):r.push("("+s+"("+o.join(", ")+") = "+n+")")}else if(c===ye)s=r.pop(),r.push(s+"."+h.value);else if(c===_e){for(l=h.value,o=[];l-- >0;)o.unshift(r.pop());r.push("["+o.join(", ")+"]")}else if(c===z)r.push("("+pt(h.value,t)+")");else if(c!==He)throw new Error("invalid Expression")}return r.length>1&&(t?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function zt(e){return typeof e=="string"?JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):e}function Te(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return!0;return!1}function ft(e,t,r){r=r||{};for(var s=!!r.withMembers,n=null,a=0;a<e.length;a++){var i=e[a];i.type===ne||i.type===de?!s&&!Te(t,i.value)?t.push(i.value):(n!==null&&(Te(t,n)||t.push(n)),n=i.value):i.type===ye&&s&&n!==null?n+="."+i.value:i.type===z?ft(i.value,t,r):n!==null&&(Te(t,n)||t.push(n),n=null)}n!==null&&!Te(t,n)&&t.push(n)}function X(e,t){this.tokens=e,this.parser=t,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.functions=t.functions}X.prototype.simplify=function(e){return e=e||{},new X(lt(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,e),this.parser)},X.prototype.substitute=function(e,t){return t instanceof X||(t=this.parser.parse(String(t))),new X(qt(this.tokens,e,t),this.parser)},X.prototype.evaluate=function(e){return e=e||{},ve(this.tokens,this,e)},X.prototype.toString=function(){return pt(this.tokens,!1)},X.prototype.symbols=function(e){e=e||{};var t=[];return ft(this.tokens,t,e),t},X.prototype.variables=function(e){e=e||{};var t=[];ft(this.tokens,t,e);var r=this.functions;return t.filter(function(s){return!(s in r)})},X.prototype.toJSFunction=function(e,t){var r=this,s=new Function(e,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+pt(this.simplify(t).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var Oe="TEOF",k="TOP",qe="TNUMBER",Wt="TSTRING",oe="TPAREN",Ee="TBRACKET",ze="TCOMMA",ct="TNAME",dt="TSEMICOLON";function Kt(e,t,r){this.type=e,this.value=t,this.index=r}Kt.prototype.toString=function(){return this.type+": "+this.value};function S(e,t){this.pos=0,this.current=null,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.consts=e.consts,this.expression=t,this.savedPosition=0,this.savedCurrent=null,this.options=e.options,this.parser=e}S.prototype.newToken=function(e,t,r){return new Kt(e,t,r!=null?r:this.pos)},S.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},S.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},S.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(Oe,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},S.prototype.isString=function(){var e=!1,t=this.pos,r=this.expression.charAt(t);if(r==="'"||r==='"')for(var s=this.expression.indexOf(r,t+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,this.expression.charAt(s-1)!=="\\"){var n=this.expression.substring(t+1,s);this.current=this.newToken(Wt,this.unescape(n),t),e=!0;break}s=this.expression.indexOf(r,s+1)}return e},S.prototype.isParen=function(){var e=this.expression.charAt(this.pos);return e==="("||e===")"?(this.current=this.newToken(oe,e),this.pos++,!0):!1},S.prototype.isBracket=function(){var e=this.expression.charAt(this.pos);return(e==="["||e==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(Ee,e),this.pos++,!0):!1},S.prototype.isComma=function(){var e=this.expression.charAt(this.pos);return e===","?(this.current=this.newToken(ze,","),this.pos++,!0):!1},S.prototype.isSemicolon=function(){var e=this.expression.charAt(this.pos);return e===";"?(this.current=this.newToken(dt,";"),this.pos++,!0):!1},S.prototype.isConst=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(t>e){var s=this.expression.substring(e,t);if(s in this.consts)return this.current=this.newToken(qe,this.consts[s]),this.pos+=s.length,!0}return!1},S.prototype.isNamedOp=function(){for(var e=this.pos,t=e;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(t>e){var s=this.expression.substring(e,t);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(k,s),this.pos+=s.length,!0}return!1},S.prototype.isName=function(){for(var e=this.pos,t=e,r=!1;t<this.expression.length;t++){var s=this.expression.charAt(t);if(s.toUpperCase()===s.toLowerCase()){if(t===this.pos&&(s==="$"||s==="_")){s==="_"&&(r=!0);continue}else if(t===this.pos||!r||s!=="_"&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(e,t);return this.current=this.newToken(ct,n),this.pos+=n.length,!0}return!1},S.prototype.isWhitespace=function(){for(var e=!1,t=this.expression.charAt(this.pos);(t===" "||t==="	"||t===`
`||t==="\r")&&(e=!0,this.pos++,!(this.pos>=this.expression.length));)t=this.expression.charAt(this.pos);return e};var os=/^[0-9a-f]{4}$/i;S.prototype.unescape=function(e){var t=e.indexOf("\\");if(t<0)return e;for(var r=e.substring(0,t);t>=0;){var s=e.charAt(++t);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var n=e.substring(t+1,t+5);os.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),t+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++t;var a=e.indexOf("\\",t);r+=e.substring(t,a<0?e.length:a),t=a}return r},S.prototype.isComment=function(){var e=this.expression.charAt(this.pos);return e==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1},S.prototype.isRadixInteger=function(){var e=this.pos;if(e>=this.expression.length-2||this.expression.charAt(e)!=="0")return!1;++e;var t,r;if(this.expression.charAt(e)==="x")t=16,r=/^[0-9a-f]$/i,++e;else if(this.expression.charAt(e)==="b")t=2,r=/^[01]$/i,++e;else return!1;for(var s=!1,n=e;e<this.expression.length;){var a=this.expression.charAt(e);if(r.test(a))e++,s=!0;else break}return s&&(this.current=this.newToken(qe,parseInt(this.expression.substring(n,e),t)),this.pos=e),s},S.prototype.isNumber=function(){for(var e=!1,t=this.pos,r=t,s=t,n=!1,a=!1,i;t<this.expression.length&&(i=this.expression.charAt(t),i>="0"&&i<="9"||!n&&i===".");)i==="."?n=!0:a=!0,t++,e=a;if(e&&(s=t),i==="e"||i==="E"){t++;for(var o=!0,l=!1;t<this.expression.length;){if(i=this.expression.charAt(t),o&&(i==="+"||i==="-"))o=!1;else if(i>="0"&&i<="9")l=!0,o=!1;else break;t++}l||(t=s)}return e?(this.current=this.newToken(qe,parseFloat(this.expression.substring(r,t))),this.pos=t):this.pos=s,e},S.prototype.isOperator=function(){var e=this.pos,t=this.expression.charAt(this.pos);if(t==="+"||t==="-"||t==="*"||t==="/"||t==="%"||t==="^"||t==="?"||t===":"||t===".")this.current=this.newToken(k,t);else if(t==="\u2219"||t==="\u2022")this.current=this.newToken(k,"*");else if(t===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(k,">="),this.pos++):this.current=this.newToken(k,">");else if(t==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(k,"<="),this.pos++):this.current=this.newToken(k,"<");else if(t==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(k,"||"),this.pos++;else return!1;else if(t==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(k,"=="),this.pos++):this.current=this.newToken(k,t);else if(t==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(k,"!="),this.pos++):this.current=this.newToken(k,t);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=e,!1)},S.prototype.isOperatorEnabled=function(e){return this.parser.isOperatorEnabled(e)},S.prototype.getCoordinates=function(){var e=0,t,r=-1;do e++,t=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:e,column:t}},S.prototype.parseError=function(e){var t=this.getCoordinates();throw new Error("parse error ["+t.line+":"+t.column+"]: "+e)};function O(e,t,r){this.parser=e,this.tokens=t,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}O.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},O.prototype.tokenMatches=function(e,t){return typeof t>"u"?!0:Array.isArray(t)?Te(t,e.value):typeof t=="function"?t(e):e.value===t},O.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},O.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},O.prototype.accept=function(e,t){return this.nextToken.type===e&&this.tokenMatches(this.nextToken,t)?(this.next(),!0):!1},O.prototype.expect=function(e,t){if(!this.accept(e,t)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(t||e))}},O.prototype.parseAtom=function(e){var t=this.tokens.unaryOps;function r(n){return n.value in t}if(this.accept(ct)||this.accept(k,r))e.push(new D(ne,this.current.value));else if(this.accept(qe))e.push(new D(Z,this.current.value));else if(this.accept(Wt))e.push(new D(Z,this.current.value));else if(this.accept(oe,"("))this.parseExpression(e),this.expect(oe,")");else if(this.accept(Ee,"["))if(this.accept(Ee,"]"))e.push(new D(_e,0));else{var s=this.parseArrayList(e);e.push(new D(_e,s))}else throw new Error("unexpected "+this.nextToken)},O.prototype.parseExpression=function(e){var t=[];this.parseUntilEndStatement(e,t)||(this.parseVariableAssignmentExpression(t),!this.parseUntilEndStatement(e,t)&&this.pushExpression(e,t))},O.prototype.pushExpression=function(e,t){for(var r=0,s=t.length;r<s;r++)e.push(t[r])},O.prototype.parseUntilEndStatement=function(e,t){return this.accept(dt)?(this.nextToken&&this.nextToken.type!==Oe&&!(this.nextToken.type===oe&&this.nextToken.value===")")&&t.push(new D(He)),this.nextToken.type!==Oe&&this.parseExpression(t),e.push(new D(z,t)),!0):!1},O.prototype.parseArrayList=function(e){for(var t=0;!this.accept(Ee,"]");)for(this.parseExpression(e),++t;this.accept(ze);)this.parseExpression(e),++t;return t},O.prototype.parseVariableAssignmentExpression=function(e){for(this.parseConditionalExpression(e);this.accept(k,"=");){var t=e.pop(),r=[],s=e.length-1;if(t.type===$e){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,a=t.value+1;n<a;n++){var i=s-n;e[i].type===ne&&(e[i]=new D(de,e[i].value))}this.parseVariableAssignmentExpression(r),e.push(new D(z,r)),e.push(new D(Ve,t.value));continue}if(t.type!==ne&&t.type!==ye)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),e.push(new D(de,t.value)),e.push(new D(z,r)),e.push(ae("="))}},O.prototype.parseConditionalExpression=function(e){for(this.parseOrExpression(e);this.accept(k,"?");){var t=[],r=[];this.parseConditionalExpression(t),this.expect(k,":"),this.parseConditionalExpression(r),e.push(new D(z,t)),e.push(new D(z,r)),e.push(Gt("?"))}},O.prototype.parseOrExpression=function(e){for(this.parseAndExpression(e);this.accept(k,"or");){var t=[];this.parseAndExpression(t),e.push(new D(z,t)),e.push(ae("or"))}},O.prototype.parseAndExpression=function(e){for(this.parseComparison(e);this.accept(k,"and");){var t=[];this.parseComparison(t),e.push(new D(z,t)),e.push(ae("and"))}};var us=["==","!=","<","<=",">=",">","in"];O.prototype.parseComparison=function(e){for(this.parseAddSub(e);this.accept(k,us);){var t=this.current;this.parseAddSub(e),e.push(ae(t.value))}};var ls=["+","-","||"];O.prototype.parseAddSub=function(e){for(this.parseTerm(e);this.accept(k,ls);){var t=this.current;this.parseTerm(e),e.push(ae(t.value))}};var hs=["*","/","%"];O.prototype.parseTerm=function(e){for(this.parseFactor(e);this.accept(k,hs);){var t=this.current;this.parseFactor(e),e.push(ae(t.value))}},O.prototype.parseFactor=function(e){var t=this.tokens.unaryOps;function r(n){return n.value in t}if(this.save(),this.accept(k,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===oe&&this.nextToken.value==="("){this.restore(),this.parseExponential(e);return}else if(this.nextToken.type===dt||this.nextToken.type===ze||this.nextToken.type===Oe||this.nextToken.type===oe&&this.nextToken.value===")"){this.restore(),this.parseAtom(e);return}}var s=this.current;this.parseFactor(e),e.push(Ge(s.value))}else this.parseExponential(e)},O.prototype.parseExponential=function(e){for(this.parsePostfixExpression(e);this.accept(k,"^");)this.parseFactor(e),e.push(ae("^"))},O.prototype.parsePostfixExpression=function(e){for(this.parseFunctionCall(e);this.accept(k,"!");)e.push(Ge("!"))},O.prototype.parseFunctionCall=function(e){var t=this.tokens.unaryOps;function r(a){return a.value in t}if(this.accept(k,r)){var s=this.current;this.parseAtom(e),e.push(Ge(s.value))}else for(this.parseMemberExpression(e);this.accept(oe,"(");)if(this.accept(oe,")"))e.push(new D($e,0));else{var n=this.parseArgumentList(e);e.push(new D($e,n))}},O.prototype.parseArgumentList=function(e){for(var t=0;!this.accept(oe,")");)for(this.parseExpression(e),++t;this.accept(ze);)this.parseExpression(e),++t;return t},O.prototype.parseMemberExpression=function(e){for(this.parseAtom(e);this.accept(k,".")||this.accept(Ee,"[");){var t=this.current;if(t.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(ct),e.push(new D(ye,this.current.value))}else if(t.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(e),this.expect(Ee,"]"),e.push(ae("["))}else throw new Error("unexpected symbol: "+t.value)}};function ps(e,t){return Number(e)+Number(t)}function fs(e,t){return e-t}function cs(e,t){return e*t}function ds(e,t){return e/t}function ys(e,t){return e%t}function vs(e,t){return Array.isArray(e)&&Array.isArray(t)?e.concat(t):""+e+t}function ms(e,t){return e===t}function gs(e,t){return e!==t}function bs(e,t){return e>t}function ws(e,t){return e<t}function Ms(e,t){return e>=t}function xs(e,t){return e<=t}function As(e,t){return Boolean(e&&t)}function Ds(e,t){return Boolean(e||t)}function $s(e,t){return Te(t,e)}function _s(e){return(Math.exp(e)-Math.exp(-e))/2}function Ts(e){return(Math.exp(e)+Math.exp(-e))/2}function Es(e){return e===1/0?1:e===-1/0?-1:(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}function Fs(e){return e===-1/0?e:Math.log(e+Math.sqrt(e*e+1))}function ks(e){return Math.log(e+Math.sqrt(e*e-1))}function Os(e){return Math.log((1+e)/(1-e))/2}function Zt(e){return Math.log(e)*Math.LOG10E}function Is(e){return-e}function Ss(e){return!e}function Cs(e){return e<0?Math.ceil(e):Math.floor(e)}function Ns(e){return Math.random()*(e||1)}function Jt(e){return vt(e+1)}function Ys(e){return isFinite(e)&&e===Math.round(e)}var Ps=4.7421875,yt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function vt(e){var t,r;if(Ys(e)){if(e<=0)return isFinite(e)?1/0:NaN;if(e>171)return 1/0;for(var s=e-2,n=e-1;s>1;)n*=s,s--;return n===0&&(n=1),n}if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*vt(1-e));if(e>=171.35)return 1/0;if(e>85){var a=e*e,i=a*e,o=i*e,l=o*e;return Math.sqrt(2*Math.PI/e)*Math.pow(e/Math.E,e)*(1+1/(12*e)+1/(288*a)-139/(51840*i)-571/(2488320*o)+163879/(209018880*l)+5246819/(75246796800*l*e))}--e,r=yt[0];for(var u=1;u<yt.length;++u)r+=yt[u]/(e+u);return t=e+Ps+.5,Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*r}function Bs(e){return Array.isArray(e)?e.length:String(e).length}function Xt(){for(var e=0,t=0,r=0;r<arguments.length;r++){var s=Math.abs(arguments[r]),n;t<s?(n=t/s,e=e*n*n+1,t=s):s>0?(n=s/t,e+=n*n):e+=s}return t===1/0?1/0:t*Math.sqrt(e)}function Qt(e,t,r){return e?t:r}function js(e,t){return typeof t>"u"||+t==0?Math.round(e):(e=+e,t=-+t,isNaN(e)||!(typeof t=="number"&&t%1===0)?NaN:(e=e.toString().split("e"),e=Math.round(+(e[0]+"e"+(e[1]?+e[1]-t:-t))),e=e.toString().split("e"),+(e[0]+"e"+(e[1]?+e[1]+t:t))))}function Ls(e,t,r){return r&&(r[e]=t),t}function Rs(e,t){return e[t|0]}function Us(e){return arguments.length===1&&Array.isArray(e)?Math.max.apply(Math,e):Math.max.apply(Math,arguments)}function Vs(e){return arguments.length===1&&Array.isArray(e)?Math.min.apply(Math,e):Math.min.apply(Math,arguments)}function Hs(e,t){if(typeof e!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(t))throw new Error("Second argument to map is not an array");return t.map(function(r,s){return e(r,s)})}function Gs(e,t,r){if(typeof e!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(s,n,a){return e(s,n,a)},t)}function qs(e,t){if(typeof e!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(t))throw new Error("Second argument to filter is not an array");return t.filter(function(r,s){return e(r,s)})}function zs(e,t){if(!(Array.isArray(t)||typeof t=="string"))throw new Error("Second argument to indexOf is not a string or array");return t.indexOf(e)}function Ws(e,t){if(!Array.isArray(t))throw new Error("Second argument to join is not an array");return t.join(e)}function Ks(e){return(e>0)-(e<0)||+e}var er=1/3;function Zs(e){return e<0?-Math.pow(-e,er):Math.pow(e,er)}function Js(e){return Math.exp(e)-1}function Xs(e){return Math.log(1+e)}function Qs(e){return Math.log(e)/Math.LN2}function me(e){this.options=e||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||_s,cosh:Math.cosh||Ts,tanh:Math.tanh||Es,asinh:Math.asinh||Fs,acosh:Math.acosh||ks,atanh:Math.atanh||Os,sqrt:Math.sqrt,cbrt:Math.cbrt||Zs,log:Math.log,log2:Math.log2||Qs,ln:Math.log,lg:Math.log10||Zt,log10:Math.log10||Zt,expm1:Math.expm1||Js,log1p:Math.log1p||Xs,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||Cs,"-":Is,"+":Number,exp:Math.exp,not:Ss,length:Bs,"!":Jt,sign:Math.sign||Ks},this.binaryOps={"+":ps,"-":fs,"*":cs,"/":ds,"%":ys,"^":Math.pow,"||":vs,"==":ms,"!=":gs,">":bs,"<":ws,">=":Ms,"<=":xs,and:As,or:Ds,in:$s,"=":Ls,"[":Rs},this.ternaryOps={"?":Qt},this.functions={random:Ns,fac:Jt,min:Vs,max:Us,hypot:Math.hypot||Xt,pyt:Math.hypot||Xt,pow:Math.pow,atan2:Math.atan2,if:Qt,gamma:vt,roundTo:js,map:Hs,fold:Gs,filter:qs,indexOf:zs,join:Ws},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}me.prototype.parse=function(e){var t=[],r=new O(this,new S(this,e),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(t),r.expect(Oe,"EOF"),new X(t,this)},me.prototype.evaluate=function(e,t){return this.parse(e).evaluate(t)};var tr=new me;me.parse=function(e){return tr.parse(e)},me.evaluate=function(e,t){return tr.parse(e).evaluate(t)};var rr={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function en(e){return rr.hasOwnProperty(e)?rr[e]:e}me.prototype.isOperatorEnabled=function(e){var t=en(e),r=this.options.operators||{};return!(t in r)||!!r[t]};const tn={context:"+",person:"@",tracker:"#"};function rn(e){const t=e.split("(");let r=t.length===2?t[1].replace(")",""):"1";return r=r.length?r:"1",sn(r)}function sn(e){const t=e.match(/[a-z/%$]+/gi),r=t?t[0]:void 0;if(e.match(/\+|-|\/|\*|Mod|\(|\)/)){e=e.replace(/[a-z]+/gi,"");try{return{value:me.evaluate(e),uom:r}}catch{return{value:0,uom:r}}}else return e.split(".").length===2?{value:parseFloat(e),uom:r}:e.search(":")>-1?{value:ss.timestringToSeconds(e),uom:"timer"}:{value:parseInt(e),uom:r}}function nn(e){const t=e.trim().replace(/(’s|'s|'|,|\.|!|’|\?|:)/gi,"");return{word:t,remainder:e.trim().replace(t,"")}}function ge(e){const{word:t,type:r,value:s,remainder:n,raw:a,uom:i}=e,o=tn[r]||"";return{id:(t.search(/\(/)>-1?t.replace(o,"").split("(")[0]:t.replace(o,"")).toLowerCase(),raw:a||t||"",prefix:o,type:r,value:s,remainder:n,uom:i}}const mt=(e="")=>e.trim().replace(/\n/g,` 
 `).split(" ").map(r=>{const s=nn(r),n=rn(r),a=r.trim().substring(0,1);if(a==="#"&&r.length>1)return r.match(/\d\d:\d\d/)?ge({type:"tracker",word:r.trim(),value:n.value,remainder:s.remainder.replace(r,""),uom:n.uom}):ge({type:"tracker",word:s.word,raw:r.trim(),value:n.value,remainder:s.remainder.replace(r,"").trim(),uom:n.uom});if(a==="@"&&r.length>1)return ge({type:"person",word:s.word.toLowerCase(),raw:r.trim(),value:n.value,remainder:s.remainder,uom:n.uom});if(a==="+"&&r.length>1)return ge({type:"context",word:s.word,raw:r.trim(),value:n.value,remainder:s.remainder,uom:n.uom});if(r.search(/(\w){3}:\/\/(\w)/)>-1)return ge({type:"link",word:r.trim().replace(/(https|http):\/\//gi,""),raw:r.trim()});if(r==`
`)return ge({type:"line-break",word:`
`});if(r)return ge({type:"generic",word:r.trim()})}).filter(r=>r);function Ie(e="",t){return t=t||{},mt(e).filter(r=>t.includeGeneric?!0:r.type!=="generic"&&r.type!=="line-break")}function an(e){const t=Ie(e);return t.length?t[0]:(e.length&&t.push({id:ts(e),prefix:"",raw:e,type:"generic"}),t.length?t[0]:null)}function on(e="",t="generic"){switch(t){case"tracker":return`#${e}`;case"person":return`@${e}`;case"context":return`+${e}`;default:return e}}var gt={parse:Ie,toElement:an,generateRaw:on,people(e){return Ie(e).filter(t=>t.type=="person")},trackers(e){return Ie(e).filter(t=>t.type=="tracker")},context(e){return Ie(e).filter(t=>t.type=="context")}};function un(e){return!isNaN(e)&&e!==null&&e!==void 0}function ln(e){return Number(e)===e&&e%1!==0}function hn(e){let t=0,r=null,l={"*":u=>{t=t*u},"-":u=>{t=t-u},"+":u=>{t=t+u},"/":u=>{t=t/u},".":u=>{ln(t)||(t=parseFloat(`${t}.${u}`))}};return e.forEach((u,h)=>{un(u)?h==0?t=u:r&&r(u):l[u]&&(r=l[u])}),e.length?t:0}function pn(e,t){for(var r,s=-1,n=e.length;++s<n;){var a=t(e[s]);a!==void 0&&(r=r===void 0?a:r+a)}return r}var sr=pn,fn=sr,cn=0/0;function dn(e,t){var r=e==null?0:e.length;return r?fn(e,t)/r:cn}var yn=dn;function vn(e){return e}var We=vn,mn=yn,gn=We;function bn(e){return mn(e,gn)}var wn=bn,Mn=typeof K=="object"&&K&&K.Object===Object&&K,nr=Mn,xn=nr,An=typeof self=="object"&&self&&self.Object===Object&&self,Dn=xn||An||Function("return this")(),bt=Dn,$n=bt,_n=$n.Symbol,wt=_n,ar=wt,ir=Object.prototype,Tn=ir.hasOwnProperty,En=ir.toString,Se=ar?ar.toStringTag:void 0;function Fn(e){var t=Tn.call(e,Se),r=e[Se];try{e[Se]=void 0;var s=!0}catch{}var n=En.call(e);return s&&(t?e[Se]=r:delete e[Se]),n}var kn=Fn,On=Object.prototype,In=On.toString;function Sn(e){return In.call(e)}var Cn=Sn,or=wt,Nn=kn,Yn=Cn,Pn="[object Null]",Bn="[object Undefined]",ur=or?or.toStringTag:void 0;function jn(e){return e==null?e===void 0?Bn:Pn:ur&&ur in Object(e)?Nn(e):Yn(e)}var Ce=jn;function Ln(e){return e!=null&&typeof e=="object"}var Ne=Ln,Rn=Ce,Un=Ne,Vn="[object Symbol]";function Hn(e){return typeof e=="symbol"||Un(e)&&Rn(e)==Vn}var Mt=Hn,Gn=Mt;function qn(e,t,r){for(var s=-1,n=e.length;++s<n;){var a=e[s],i=t(a);if(i!=null&&(o===void 0?i===i&&!Gn(i):r(i,o)))var o=i,l=a}return l}var lr=qn;function zn(e,t){return e<t}var Wn=zn,Kn=lr,Zn=Wn,Jn=We;function Xn(e){return e&&e.length?Kn(e,Jn,Zn):void 0}var Qn=Xn,ea=sr,ta=We;function ra(e){return e&&e.length?ea(e,ta):0}var sa=ra;function na(e,t){return e>t}var aa=na,ia=lr,oa=aa,ua=We;function la(e){return e&&e.length?ia(e,ua,oa):void 0}var ha=la,pa=Math.floor,fa=Math.random;function ca(e,t){return e+pa(fa()*(t-e+1))}var hr=ca;function da(e,t){return e===t||e!==e&&t!==t}var ya=da;function va(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var xt=va,ma=Ce,ga=xt,ba="[object AsyncFunction]",wa="[object Function]",Ma="[object GeneratorFunction]",xa="[object Proxy]";function Aa(e){if(!ga(e))return!1;var t=ma(e);return t==wa||t==Ma||t==ba||t==xa}var Da=Aa,$a=9007199254740991;function _a(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=$a}var pr=_a,Ta=Da,Ea=pr;function Fa(e){return e!=null&&Ea(e.length)&&!Ta(e)}var fr=Fa,ka=9007199254740991,Oa=/^(?:0|[1-9]\d*)$/;function Ia(e,t){var r=typeof e;return t=t==null?ka:t,!!t&&(r=="number"||r!="symbol"&&Oa.test(e))&&e>-1&&e%1==0&&e<t}var cr=Ia,Sa=ya,Ca=fr,Na=cr,Ya=xt;function Pa(e,t,r){if(!Ya(r))return!1;var s=typeof t;return(s=="number"?Ca(r)&&Na(t,r.length):s=="string"&&t in r)?Sa(r[t],e):!1}var Ba=Pa,ja=/\s/;function La(e){for(var t=e.length;t--&&ja.test(e.charAt(t)););return t}var Ra=La,Ua=Ra,Va=/^\s+/;function Ha(e){return e&&e.slice(0,Ua(e)+1).replace(Va,"")}var Ga=Ha,qa=Ga,dr=xt,za=Mt,yr=0/0,Wa=/^[-+]0x[0-9a-f]+$/i,Ka=/^0b[01]+$/i,Za=/^0o[0-7]+$/i,Ja=parseInt;function Xa(e){if(typeof e=="number")return e;if(za(e))return yr;if(dr(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=dr(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=qa(e);var r=Ka.test(e);return r||Za.test(e)?Ja(e.slice(2),r?2:8):Wa.test(e)?yr:+e}var vr=Xa,Qa=vr,mr=1/0,ei=17976931348623157e292;function ti(e){if(!e)return e===0?e:0;if(e=Qa(e),e===mr||e===-mr){var t=e<0?-1:1;return t*ei}return e===e?e:0}var gr=ti,ri=hr,si=Ba,br=gr,ni=parseFloat,ai=Math.min,ii=Math.random;function oi(e,t,r){if(r&&typeof r!="boolean"&&si(e,t,r)&&(t=r=void 0),r===void 0&&(typeof t=="boolean"?(r=t,t=void 0):typeof e=="boolean"&&(r=e,e=void 0)),e===void 0&&t===void 0?(e=0,t=1):(e=br(e),t===void 0?(t=e,e=0):t=br(t)),e>t){var s=e;e=t,t=s}if(r||e%1||t%1){var n=ii();return ai(e+n*(t-e+ni("1e-"+((n+"").length-1))),t)}return ri(e,t)}var ui=oi,li=gr;function hi(e){var t=li(e),r=t%1;return t===t?r?t-r:t:0}var pi=hi;function fi(e,t){for(var r=-1,s=e==null?0:e.length,n=Array(s);++r<s;)n[r]=t(e[r],r,e);return n}var wr=fi,ci=Array.isArray,At=ci,Mr=wt,di=wr,yi=At,vi=Mt,mi=1/0,xr=Mr?Mr.prototype:void 0,Ar=xr?xr.toString:void 0;function Dr(e){if(typeof e=="string")return e;if(yi(e))return di(e,Dr)+"";if(vi(e))return Ar?Ar.call(e):"";var t=e+"";return t=="0"&&1/e==-mi?"-0":t}var gi=Dr,bi=gi;function wi(e){return e==null?"":bi(e)}var Mi=wi,xi=bt,Ai=pi,Di=vr,$r=Mi,$i=xi.isFinite,_i=Math.min;function Ti(e){var t=Math[e];return function(r,s){if(r=Di(r),s=s==null?0:_i(Ai(s),292),s&&$i(r)){var n=($r(r)+"e").split("e"),a=t(n[0]+"e"+(+n[1]+s));return n=($r(a)+"e").split("e"),+(n[0]+"e"+(+n[1]-s))}return t(r)}}var Ei=Ti,Fi=Ei,ki=Fi("round"),Dt=ki,Oi=hr;function Ii(e){var t=e.length;return t?e[Oi(0,t-1)]:void 0}var _r=Ii,Si=wr;function Ci(e,t){return Si(t,function(r){return e[r]})}var Ni=Ci;function Yi(e,t){for(var r=-1,s=Array(e);++r<e;)s[r]=t(r);return s}var Pi=Yi,Bi=Ce,ji=Ne,Li="[object Arguments]";function Ri(e){return ji(e)&&Bi(e)==Li}var Ui=Ri,Tr=Ui,Vi=Ne,Er=Object.prototype,Hi=Er.hasOwnProperty,Gi=Er.propertyIsEnumerable,qi=Tr(function(){return arguments}())?Tr:function(e){return Vi(e)&&Hi.call(e,"callee")&&!Gi.call(e,"callee")},zi=qi,$t={exports:{}};function Wi(){return!1}var Ki=Wi;(function(e,t){var r=bt,s=Ki,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,i=a&&a.exports===n,o=i?r.Buffer:void 0,l=o?o.isBuffer:void 0,u=l||s;e.exports=u})($t,$t.exports);var Zi=Ce,Ji=pr,Xi=Ne,Qi="[object Arguments]",eo="[object Array]",to="[object Boolean]",ro="[object Date]",so="[object Error]",no="[object Function]",ao="[object Map]",io="[object Number]",oo="[object Object]",uo="[object RegExp]",lo="[object Set]",ho="[object String]",po="[object WeakMap]",fo="[object ArrayBuffer]",co="[object DataView]",yo="[object Float32Array]",vo="[object Float64Array]",mo="[object Int8Array]",go="[object Int16Array]",bo="[object Int32Array]",wo="[object Uint8Array]",Mo="[object Uint8ClampedArray]",xo="[object Uint16Array]",Ao="[object Uint32Array]",I={};I[yo]=I[vo]=I[mo]=I[go]=I[bo]=I[wo]=I[Mo]=I[xo]=I[Ao]=!0,I[Qi]=I[eo]=I[fo]=I[to]=I[co]=I[ro]=I[so]=I[no]=I[ao]=I[io]=I[oo]=I[uo]=I[lo]=I[ho]=I[po]=!1;function Do(e){return Xi(e)&&Ji(e.length)&&!!I[Zi(e)]}var $o=Do;function _o(e){return function(t){return e(t)}}var To=_o,_t={exports:{}};(function(e,t){var r=nr,s=t&&!t.nodeType&&t,n=s&&!0&&e&&!e.nodeType&&e,a=n&&n.exports===s,i=a&&r.process,o=function(){try{var l=n&&n.require&&n.require("util").types;return l||i&&i.binding&&i.binding("util")}catch{}}();e.exports=o})(_t,_t.exports);var Eo=$o,Fo=To,Fr=_t.exports,kr=Fr&&Fr.isTypedArray,ko=kr?Fo(kr):Eo,Oo=ko,Io=Pi,So=zi,Co=At,No=$t.exports,Yo=cr,Po=Oo,Bo=Object.prototype,jo=Bo.hasOwnProperty;function Lo(e,t){var r=Co(e),s=!r&&So(e),n=!r&&!s&&No(e),a=!r&&!s&&!n&&Po(e),i=r||s||n||a,o=i?Io(e.length,String):[],l=o.length;for(var u in e)(t||jo.call(e,u))&&!(i&&(u=="length"||n&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Yo(u,l)))&&o.push(u);return o}var Ro=Lo,Uo=Object.prototype;function Vo(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Uo;return e===r}var Ho=Vo;function Go(e,t){return function(r){return e(t(r))}}var qo=Go,zo=qo,Wo=zo(Object.keys,Object),Ko=Wo,Zo=Ho,Jo=Ko,Xo=Object.prototype,Qo=Xo.hasOwnProperty;function eu(e){if(!Zo(e))return Jo(e);var t=[];for(var r in Object(e))Qo.call(e,r)&&r!="constructor"&&t.push(r);return t}var tu=eu,ru=Ro,su=tu,nu=fr;function au(e){return nu(e)?ru(e):su(e)}var iu=au,ou=Ni,uu=iu;function lu(e){return e==null?[]:ou(e,uu(e))}var hu=lu,pu=_r,fu=hu;function cu(e){return pu(fu(e))}var du=cu,yu=_r,vu=du,mu=At;function gu(e){var t=mu(e)?yu:vu;return t(e)}var bu=gu,H=function(e){this.value=e};H.math={isDegree:!0,acos:function(e){return H.math.isDegree?180/Math.PI*Math.acos(e):Math.acos(e)},add:function(e,t){return e+t},asin:function(e){return H.math.isDegree?180/Math.PI*Math.asin(e):Math.asin(e)},atan:function(e){return H.math.isDegree?180/Math.PI*Math.atan(e):Math.atan(e)},acosh:function(e){return Math.log(e+Math.sqrt(e*e-1))},asinh:function(e){return Math.log(e+Math.sqrt(e*e+1))},atanh:function(e){return Math.log((1+e)/(1-e))},C:function(e,t){var r=1,s=e-t,n=t;n<s&&(n=s,s=t);for(var a=n+1;a<=e;a++)r*=a;return r/H.math.fact(s)},changeSign:function(e){return-e},cos:function(e){return H.math.isDegree&&(e=H.math.toRadian(e)),Math.cos(e)},cosh:function(e){return(Math.pow(Math.E,e)+Math.pow(Math.E,-1*e))/2},div:function(e,t){return e/t},fact:function(e){if(e%1!==0)return"NaN";for(var t=1,r=2;r<=e;r++)t*=r;return t},inverse:function(e){return 1/e},log:function(e){return Math.log(e)/Math.log(10)},mod:function(e,t){return e%t},mul:function(e,t){return e*t},P:function(e,t){for(var r=1,s=Math.floor(e)-Math.floor(t)+1;s<=Math.floor(e);s++)r*=s;return r},Pi:function(e,t,r){for(var s=1,n=e;n<=t;n++)s*=Number(r.postfixEval({n}));return s},pow10x:function(e){for(var t=1;e--;)t*=10;return t},sigma:function(e,t,r){for(var s=0,n=e;n<=t;n++)s+=Number(r.postfixEval({n}));return s},sin:function(e){return H.math.isDegree&&(e=H.math.toRadian(e)),Math.sin(e)},sinh:function(e){return(Math.pow(Math.E,e)-Math.pow(Math.E,-1*e))/2},sub:function(e,t){return e-t},tan:function(e){return H.math.isDegree&&(e=H.math.toRadian(e)),Math.tan(e)},tanh:function(e){return H.sinha(e)/H.cosha(e)},toRadian:function(e){return e*Math.PI/180},and:function(e,t){return e&t}},H.Exception=function(e){this.message=e};var wu=H,b=wu;function G(e,t){for(var r=0;r<e.length;r++)e[r]+=t;return e}for(var le=[{token:"sin",show:"sin",type:0,value:b.math.sin},{token:"cos",show:"cos",type:0,value:b.math.cos},{token:"tan",show:"tan",type:0,value:b.math.tan},{token:"pi",show:"&pi;",type:3,value:"PI"},{token:"(",show:"(",type:4,value:"("},{token:")",show:")",type:5,value:")"},{token:"P",show:"P",type:10,value:b.math.P},{token:"C",show:"C",type:10,value:b.math.C},{token:" ",show:" ",type:14,value:" ".anchor},{token:"asin",show:"asin",type:0,value:b.math.asin},{token:"acos",show:"acos",type:0,value:b.math.acos},{token:"atan",show:"atan",type:0,value:b.math.atan},{token:"7",show:"7",type:1,value:"7"},{token:"8",show:"8",type:1,value:"8"},{token:"9",show:"9",type:1,value:"9"},{token:"int",show:"Int",type:0,value:Math.floor},{token:"cosh",show:"cosh",type:0,value:b.math.cosh},{token:"acosh",show:"acosh",type:0,value:b.math.acosh},{token:"ln",show:" ln",type:0,value:Math.log},{token:"^",show:"^",type:10,value:Math.pow},{token:"root",show:"root",type:0,value:Math.sqrt},{token:"4",show:"4",type:1,value:"4"},{token:"5",show:"5",type:1,value:"5"},{token:"6",show:"6",type:1,value:"6"},{token:"/",show:"&divide;",type:2,value:b.math.div},{token:"!",show:"!",type:7,value:b.math.fact},{token:"tanh",show:"tanh",type:0,value:b.math.tanh},{token:"atanh",show:"atanh",type:0,value:b.math.atanh},{token:"Mod",show:" Mod ",type:2,value:b.math.mod},{token:"1",show:"1",type:1,value:"1"},{token:"2",show:"2",type:1,value:"2"},{token:"3",show:"3",type:1,value:"3"},{token:"*",show:"&times;",type:2,value:b.math.mul},{token:"sinh",show:"sinh",type:0,value:b.math.sinh},{token:"asinh",show:"asinh",type:0,value:b.math.asinh},{token:"e",show:"e",type:3,value:"E"},{token:"log",show:" log",type:0,value:b.math.log},{token:"0",show:"0",type:1,value:"0"},{token:".",show:".",type:6,value:"."},{token:"+",show:"+",type:9,value:b.math.add},{token:"-",show:"-",type:9,value:b.math.sub},{token:",",show:",",type:11,value:","},{token:"Sigma",show:"&Sigma;",type:12,value:b.math.sigma},{token:"n",show:"n",type:13,value:"n"},{token:"Pi",show:"&Pi;",type:12,value:b.math.Pi},{token:"pow",show:"pow",type:8,value:Math.pow,numberOfArguments:2},{token:"&",show:"&",type:9,value:b.math.and}],Tt={0:11,1:0,2:3,3:0,4:0,5:0,6:0,7:11,8:11,9:1,10:10,11:0,12:11,13:0,14:-1,15:11},Ke=0;Ke<le.length;Ke++)le[Ke].precedence=Tt[le[Ke].type];var te={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,9:!0,12:!0,13:!0,14:!0,15:!0},Fe={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0,15:!0},Mu={0:!0,3:!0,4:!0,8:!0,12:!0,13:!0,15:!0},Q={},Ye={0:!0,1:!0,3:!0,4:!0,6:!0,8:!0,12:!0,13:!0,15:!0},xu={1:!0},q=[[],["1","2","3","7","8","9","4","5","6","+","-","*","/","(",")","^","!","P","C","e","0",".",",","n"," ","&"],["pi","ln","Pi"],["sin","cos","tan","Del","int","Mod","log","pow"],["asin","acos","atan","cosh","root","tanh","sinh"],["acosh","atanh","asinh","Sigma"]];function Au(e,t,r,s){for(var n=0;n<s;n++)if(e[r+n]!==t[n])return!1;return!0}b.tokenTypes={FUNCTION_WITH_ONE_ARG:0,NUMBER:1,BINARY_OPERATOR_HIGH_PRECENDENCE:2,CONSTANT:3,OPENING_PARENTHESIS:4,CLOSING_PARENTHESIS:5,DECIMAL:6,POSTFIX_FUNCTION_WITH_ONE_ARG:7,FUNCTION_WITH_N_ARGS:8,BINARY_OPERATOR_LOW_PRECENDENCE:9,BINARY_OPERATOR_PERMUTATION:10,COMMA:11,EVALUATED_FUNCTION:12,EVALUATED_FUNCTION_PARAMETER:13,SPACE:14},b.addToken=function(e){for(var t=0;t<e.length;t++){var r=e[t].token.length,s=-1;e[t].type===b.tokenTypes.FUNCTION_WITH_N_ARGS&&e[t].numberOfArguments===void 0&&(e[t].numberOfArguments=2),q[r]=q[r]||[];for(var n=0;n<q[r].length;n++)if(e[t].token===q[r][n]){s=Or(q[r][n],le);break}s===-1?(le.push(e[t]),e[t].precedence=Tt[e[t].type],q.length<=e[t].token.length&&(q[e[t].token.length]=[]),q[e[t].token.length].push(e[t].token)):(le[s]=e[t],e[t].precedence=Tt[e[t].type])}};function Or(e,t){for(var r=0;r<t.length;r++)if(t[r].token===e)return r;return-1}function Du(e){for(var t=[],r=e.length,s,n,a,i=0;i<r;i++)if(!(i<r-1&&e[i]===" "&&e[i+1]===" ")){for(s="",n=e.length-i>q.length-2?q.length-1:e.length-i;n>0;n--)if(q[n]!==void 0)for(a=0;a<q[n].length;a++)Au(e,q[n][a],i,n)&&(s=q[n][a],a=q[n].length,n=0);if(i+=s.length-1,s==="")throw new b.Exception("Can't understand after "+e.slice(i));t.push(le[Or(s,le)])}return t}var $u={value:b.math.changeSign,type:0,pre:21,show:"-"},Ze={value:")",show:")",type:5,pre:0},Pe={value:"(",type:4,pre:0,show:"("};b.lex=function(e,t){var r=[Pe],s=[],n=e,a=te,i=0,o=Q,l="",u;typeof t<"u"&&b.addToken(t);var h={},c=Du(n);for(u=0;u<c.length;u++){var p=c[u];if(p.type===14){if(u>0&&u<c.length-1&&c[u+1].type===1&&(c[u-1].type===1||c[u-1].type===6))throw new b.Exception("Unexpected Space");continue}var m=p.token,g=p.type,T=p.value,B=p.precedence,j=p.show,$=r[r.length-1],N;for(N=s.length;N--&&s[N]===0;)if([0,2,3,4,5,9,11,12,13].indexOf(g)!==-1){if(a[g]!==!0)throw new b.Exception(m+" is not allowed after "+l);r.push(Ze),a=Fe,o=Ye,s.pop()}if(a[g]!==!0)throw new b.Exception(m+" is not allowed after "+l);if(o[g]===!0&&(g=2,T=b.math.mul,j="&times;",B=3,u=u-1),h={value:T,type:g,pre:B,show:j,numberOfArguments:p.numberOfArguments},g===0)a=te,o=Q,G(s,2),r.push(h),c[u+1].type!==4&&(r.push(Pe),s.push(2));else if(g===1)$.type===1?($.value+=T,G(s,1)):r.push(h),a=Fe,o=Mu;else if(g===2)a=te,o=Q,G(s,2),r.push(h);else if(g===3)r.push(h),a=Fe,o=Ye;else if(g===4)G(s,1),i++,a=te,o=Q,r.push(h);else if(g===5){if(!i)throw new b.Exception("Closing parenthesis are more than opening one, wait What!!!");i--,a=Fe,o=Ye,r.push(h),G(s,1)}else if(g===6){if($.hasDec)throw new b.Exception("Two decimals are not allowed in one number");$.type!==1&&($={value:0,type:1,pre:0},r.push($)),a=xu,G(s,1),o=Q,$.value+=T,$.hasDec=!0}else g===7&&(a=Fe,o=Ye,G(s,1),r.push(h));g===8?(a=te,o=Q,G(s,p.numberOfArguments+2),r.push(h),c[u+1].type!==4&&(r.push(Pe),s.push(p.numberOfArguments+2))):g===9?($.type===9?$.value===b.math.add?($.value=T,$.show=j,G(s,1)):$.value===b.math.sub&&j==="-"&&($.value=b.math.add,$.show="+",G(s,1)):$.type!==5&&$.type!==7&&$.type!==1&&$.type!==3&&$.type!==13?m==="-"&&(a=te,o=Q,G(s,2).push(2),r.push($u),r.push(Pe)):(r.push(h),G(s,2)),a=te,o=Q):g===10?(a=te,o=Q,G(s,2),r.push(h)):g===11?(a=te,o=Q,r.push(h)):g===12?(a=te,o=Q,G(s,6),r.push(h),c[u+1].type!==4&&(r.push(Pe),s.push(6))):g===13&&(a=Fe,o=Ye,r.push(h)),G(s,-1),l=m}for(N=s.length;N--;)r.push(Ze);if(a[5]!==!0)throw new b.Exception("complete the expression");for(;i--;)r.push(Ze);return r.push(Ze),new b(r)};var _u=b,Et=_u;Et.prototype.toPostfix=function(){for(var e=[],t,r,s,n,a,i=[{value:"(",type:4,pre:0}],o=this.value,l=1;l<o.length;l++)if(o[l].type===1||o[l].type===3||o[l].type===13)o[l].type===1&&(o[l].value=Number(o[l].value)),e.push(o[l]);else if(o[l].type===4)i.push(o[l]);else if(o[l].type===5)for(;(r=i.pop()).type!==4;)e.push(r);else if(o[l].type===11){for(;(r=i.pop()).type!==4;)e.push(r);i.push(r)}else{t=o[l],n=t.pre,a=i[i.length-1],s=a.pre;var u=a.value=="Math.pow"&&t.value=="Math.pow";if(n>s)i.push(t);else{for(;s>=n&&!u||u&&n<s;)r=i.pop(),a=i[i.length-1],e.push(r),s=a.pre,u=t.value=="Math.pow"&&a.value=="Math.pow";i.push(t)}}return new Et(e)};var Tu=Et,Be=Tu;Be.prototype.postfixEval=function(e){e=e||{},e.PI=Math.PI,e.E=Math.E;for(var t=[],r,s,n,a=this.value,i=typeof e.n<"u",o=0;o<a.length;o++)if(a[o].type===1)t.push({value:a[o].value,type:1});else if(a[o].type===3)t.push({value:e[a[o].value],type:1});else if(a[o].type===0)typeof t[t.length-1].type>"u"?t[t.length-1].value.push(a[o]):t[t.length-1].value=a[o].value(t[t.length-1].value);else if(a[o].type===7)typeof t[t.length-1].type>"u"?t[t.length-1].value.push(a[o]):t[t.length-1].value=a[o].value(t[t.length-1].value);else if(a[o].type===8){for(var l=[],u=0;u<a[o].numberOfArguments;u++)l.push(t.pop().value);t.push({type:1,value:a[o].value.apply(a[o],l.reverse())})}else a[o].type===10?(r=t.pop(),s=t.pop(),typeof s.type>"u"?(s.value=s.concat(r),s.value.push(a[o]),t.push(s)):typeof r.type>"u"?(r.unshift(s),r.push(a[o]),t.push(r)):t.push({type:1,value:a[o].value(s.value,r.value)})):a[o].type===2||a[o].type===9?(r=t.pop(),s=t.pop(),typeof s.type>"u"?(s=s.concat(r),s.push(a[o]),t.push(s)):typeof r.type>"u"?(r.unshift(s),r.push(a[o]),t.push(r)):t.push({type:1,value:a[o].value(s.value,r.value)})):a[o].type===12?(r=t.pop(),typeof r.type<"u"&&(r=[r]),s=t.pop(),n=t.pop(),t.push({type:1,value:a[o].value(n.value,s.value,new Be(r))})):a[o].type===13&&(i?t.push({value:e[a[o].value],type:3}):t.push([a[o]]));if(t.length>1)throw new Be.Exception("Uncaught Syntax error");return t[0].value>1e15?"Infinity":parseFloat(t[0].value.toFixed(15))},Be.eval=function(e,t,r){return typeof t>"u"?this.lex(e).toPostfix().postfixEval():typeof r>"u"?typeof t.length<"u"?this.lex(e,t).toPostfix().postfixEval():this.lex(e).toPostfix().postfixEval(t):this.lex(e,t).toPostfix().postfixEval(r)};var Eu=Be,Ir=Eu;Ir.prototype.formulaEval=function(){for(var e,t,r,s=[],n=this.value,a=0;a<n.length;a++)n[a].type===1||n[a].type===3?s.push({value:n[a].type===3?n[a].show:n[a].value,type:1}):n[a].type===13?s.push({value:n[a].show,type:1}):n[a].type===0?s[s.length-1]={value:n[a].show+(n[a].show!="-"?"(":"")+s[s.length-1].value+(n[a].show!="-"?")":""),type:0}:n[a].type===7?s[s.length-1]={value:(s[s.length-1].type!=1?"(":"")+s[s.length-1].value+(s[s.length-1].type!=1?")":"")+n[a].show,type:7}:n[a].type===10?(e=s.pop(),t=s.pop(),n[a].show==="P"||n[a].show==="C"?s.push({value:"<sup>"+t.value+"</sup>"+n[a].show+"<sub>"+e.value+"</sub>",type:10}):s.push({value:(t.type!=1?"(":"")+t.value+(t.type!=1?")":"")+"<sup>"+e.value+"</sup>",type:1})):n[a].type===2||n[a].type===9?(e=s.pop(),t=s.pop(),s.push({value:(t.type!=1?"(":"")+t.value+(t.type!=1?")":"")+n[a].show+(e.type!=1?"(":"")+e.value+(e.type!=1?")":""),type:n[a].type})):n[a].type===12&&(e=s.pop(),t=s.pop(),r=s.pop(),s.push({value:n[a].show+"("+r.value+","+t.value+","+e.value+")",type:12}));return s[0].value};var Fu=Ir,R={evaluate(e){return Fu(e)},sum:e=>(e||[]).length?sa(e):0,round:(e,t)=>(t=t||100,Math.round(t*e)/t),max:e=>(e||[]).length?ha([...e]):0,min:(e,t=!1)=>e.length?(e=t==!0?e:e.filter(r=>r),Qn(e)):0,average:(e,t)=>(e=e||[0],e=e.length?e:[0],t&&(e=t?e.filter(r=>r):e),Dt(wn(e),2)||0),percentage:(e,t,r)=>Dt(r?(e-t)/e*100:100-(e-t)/e*100),random_range:(e,t)=>ui(e,t),random:e=>bu(e),percentile(e){const t=this.sum(e);return e.map(r=>this.percentage(t,r))},trustfulNumber(e,t){return isNaN(e)?t:e},isNumber(e){return!isNaN(e)&&e!==null&&e!==void 0},isInt(e){return Number(e)===e&&e%1===0},isFloat(e){return Number(e)===e&&e%1!==0},calculate(e){return hn(e)}};const re=e=>{if(typeof e=="number")return Math.round(100*e)/100;if(typeof e=="string"&&e.search(/\./)>-1){const t=parseFloat(`${e}`);return Math.round(100*t)/100}return typeof e=="string"?parseInt(`${e}`):NaN};function Sr(e,t,r){t=t||new Date;let s=gt.trackers(e||"");r=r||{};let n=s.map(a=>r[a.id]?Ue(re(a.value),r[a.id],t):0);return R.sum(n)}const Cr=["#f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#795548","#607D8B","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#B0BEC5","#e57373","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#A1887F","#90A4AE","#ef5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#8D6E63","#78909C","#f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B","#e53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A","#d32f2f","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64","#c62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F","#b71c1c","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238","#ff8a80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#64FFDA","#69F0AE","#D500F9","#3D5AFE","#2979FF","#00B0FF","#00E5FF","#1DE9B6","#00E676","#d50000","#C51162","#AA00FF","#6200EA","#304FFE","#2962FF","#0091EA","#00B8D4","#00BFA5","#00C853","#64DD17","#DD2C00"],ku=Cr,Ou=e=>new Iu(e).pick(Cr);class Iu{constructor(t){f(this,"hash");f(this,"assets");this.hash=this.fh5(t),this.assets={}}fh5(t){let r=3735928559;for(let s=0;s<t.length;s++)r=Math.imul(r^t.charCodeAt(s),2654435761);return(r^r>>>16)>>>0}xor(){return this.hash%2}pick(t,r=""){const s=Math.sqrt(parseInt(`${this.hash}${r}`,16)).toString().substr(3,4);return t.length?t[parseInt(s)%t.length]:null}}class Nr{constructor(t){f(this,"tag");f(this,"duration");f(this,"label");f(this,"avatar");f(this,"emoji");f(this,"color");t&&typeof t=="string"?(this.tag=t,this.label=t.replace("+","")):t&&typeof t=="object"&&t.tag&&(this.tag=t.tag,this.label=t.label||t.tag,this.duration=t.duration||1,this.avatar=t.avatar,this.emoji=t.emoji,this.color=t.color||Ou(this.tag))}get asObject(){return JSON.parse(JSON.stringify(this))}toTrackable(){return new be({type:"context",id:this.tag,ctx:this,value:1})}}class Su{constructor(t){f(this,"hash");f(this,"assets");this.hash=this.fh5(t),this.assets={}}fh5(t){let r=3735928559;for(let s=0;s<t.length;s++)r=Math.imul(r^t.charCodeAt(s),2654435761);return(r^r>>>16)>>>0}xor(){return this.hash%2}pick(t,r=""){const s=Math.sqrt(parseInt(`${this.hash}${r}`,16)).toString().substr(3,4);return t.length?t[parseInt(s)%t.length]:null}}class Cu{constructor(t={}){f(this,"colors",[]);f(this,"size",42);f(this,"radius",.12);this.colors=(t.colors||[]).length?t.colors:ku,this.size=t.size||42,this.radius=t.radius||.12}}const Je=(e="")=>{let t=new Cu;return new Su(e).pick(t.colors)};var Nu=Ce,Yu=Ne,Pu="[object Number]";function Bu(e){return typeof e=="number"||Yu(e)&&Nu(e)==Pu}var ju=Bu;class Ft{constructor(t={}){f(this,"username");f(this,"displayName");f(this,"avatar");f(this,"emoji");f(this,"color");f(this,"last");f(this,"notes");typeof t=="string"?(this.username=t,this.displayName=t,this.last=new Date,this.notes="",t={}):typeof t=="object"&&(this.username=t.username?t.username.toLowerCase():void 0,this.displayName=t.displayName||t.username,this.avatar=t.avatar,this.last=t.last?new Date(t.last):new Date,this.notes=t.notes||"",this.emoji=t.emoji,this.color=t.color)}setLast(t){t=t||new Date,this.last=t}getLast(){return this.last}toTrackable(){return new be({type:"person",id:this.username,person:this})}setUsername(t){this.username=t}setDisplayName(t){this.displayName=t}setAvatar(t){this.avatar=t}getUsername(){return this.username}getDisplayName(){return this.displayName||this.username}getAvatar(){return this.avatar}}const Yr={num:{singular:"Count",plural:"Count",symbol:"",type:"general"},steps:{singular:"Step",plural:"Steps",symbol:"steps",type:"general"},bottles:{singular:"Bottle",plural:"Bottles",symbol:"",type:"general"},reps:{singular:"Rep",plural:"Reps",symbol:"",type:"general"},pages:{singular:"Page",plural:"Pages",symbol:"",type:"general"},tabs:{singular:"Tab",plural:"Tabs",symbol:"",type:"health"},calorie:{singular:"Calorie",plural:"Calories",symbol:"cal",type:"health"},kcal:{singular:"Kcal",plural:"Kcals",symbol:"kcal",type:"health"},capsules:{singular:"Capsule",plural:"Capsules",symbol:"caps",type:"health"},bpm:{singular:"Beat Per Minute",plural:"Beat Per Minute",symbol:"bpm",type:"health"},pain:{singular:"Pain",plural:"Pain",symbol:"",type:"health"},percent:{singular:"Percent",plural:"Percent",symbol:"%",type:"general",symbolAffix:"post"},iu:{singular:"International Unit",plural:"International Units",symbolAffix:"post",symbol:"IU",type:"general"},dollars:{singular:"Dollar",plural:"Dollars",symbol:"$",type:"currency",symbolAffix:"pre",display:function(e){return"$"+e.toFixed(2)}},peso:{singular:"Peso",plural:"Peso",symbol:"$",type:"currency",symbolAffix:"pre",display:function(e){return"$"+e.toFixed(2)}},franc:{singular:"Franc",plural:"Francs",symbol:"Fr.",type:"currency",symbolAffix:"pre",display:function(e){return"Fr. "+e.toFixed(2)}},cpound:{singular:"Pound",plural:"Pounds",symbol:"\xA3",type:"currency",symbolAffix:"pre",display:function(e){return"\xA3"+e.toFixed(2)}},rupee:{singular:"Rupee",plural:"Rupees",symbol:"Rs.",type:"currency",symbolAffix:"pre",display:function(e){return"Rs. "+e.toFixed(2)}},yen:{singular:"Yen",plural:"Yen",symbol:"\xA5",type:"currency",symbolAffix:"pre",display:function(e){return"\xA5"+e.toFixed(2)}},yuan:{singular:"Yuan",plural:"Yuan",symbol:"\xA5",type:"currency",symbolAffix:"pre",display:function(e){return"\xA5"+e.toFixed(2)}},bitcoin:{singular:"Bitcoin",plural:"Bitcoins",type:"currency",symbolAffix:"pre",symbol:"B"},euro:{singular:"Euro",plural:"Euros",symbol:"\u20AC",type:"currency",symbolAffix:"pre",display:function(e){return"\u20AC"+e.toFixed(2)}},timer:{singular:"Time",plural:"Time",symbol:"",type:"timer",symbolAffix:"post",symbolSpace:!1,display:function(e){var t=parseInt(e,10),r=Math.floor(t/3600),s=Math.floor((t-r*3600)/60),n=t-r*3600-s*60;return r?r+"h "+s+"m":s+"m "+n+"s"}},sec:{singular:"Second",plural:"Seconds",symbol:"secs",type:"time",symbolAffix:"post",symbolSpace:!0,display:function(e){return e<3600?e+"s":Math.round(e/60*100)/100+"m"}},min:{singular:"Minute",plural:"Minutes",symbol:"m",type:"time",symbolAffix:"post",symbolSpace:!1,display:function(e){return e<60?e+"m":e>60&&e<1441?Math.round(e/60*100)/100+"h":(e>1440&&e<1e4,(e/1440).toFixed(0)+"d")}},hour:{singular:"Hour",plural:"Hours",symbol:"hrs",type:"time",symbolAffix:"post",symbolSpace:!1,display:function(e){return e<168?Math.round(e*100)/100+"h":(e/24).toFixed(0)+"d"}},day:{singular:"Day",plural:"Days",symbol:"days",type:"time"},mm:{singular:"Millimeter",plural:"Millimeters",symbol:"mm",type:"distance",system:"metric"},cm:{singular:"Centimeter",plural:"Centimeters",symbol:"cm",type:"distance",symbolAffix:"post",symbolSpace:!0,system:"metric"},meter:{singular:"Meter",plural:"Meter",symbol:"m",type:"distance",symbolAffix:"post",symbolSpace:!0,system:"metric"},km:{singular:"Kilometer",plural:"Kilometers",symbol:"km",type:"distance",symbolAffix:"post",symbolSpace:!0,system:"metric",cousin:"mile",convert(e){return e&&e*.621371}},inch:{singular:"Inch",plural:"Inches",symbol:"in",type:"distance",symbolAffix:"post",symbolSpace:!0},degrees:{singular:"Degree",plural:"Degrees",symbol:"\xB0",type:"temperature",symbolAffix:"post",symbolSpace:!1},celsius:{singular:"Celsius",plural:"Celsius",symbol:"\xB0C",type:"temperature",symbolAffix:"post",symbolSpace:!1,system:"metric",cousin:"fahrenheit"},kelvin:{singular:"Kelvin",plural:"Kelvin",symbol:"K",type:"temperature",symbolAffix:"post",symbolSpace:!1},fahrenheit:{singular:"Fahrenheit",plural:"Fahrenheit",symbol:"\xB0F",type:"temperature",symbolAffix:"post",symbolSpace:!1,system:"imperial",cousin:"celcius"},foot:{singular:"Foot",plural:"Feet",symbol:"ft",type:"distance",symbolAffix:"post",symbolSpace:!0,system:"imperial"},yard:{singular:"Yard",plural:"Yards",symbol:"yrds",type:"distance",symbolAffix:"post",symbolSpace:!0,system:"imperial"},mile:{singular:"Mile",plural:"Miles",symbol:"mi",type:"distance",symbolAffix:"post",system:"imperial",cousin:"km",convert(e){return e&&e/.621371}},mcg:{singular:"Microgram",plural:"Micrograms",symbol:"mcg",type:"weight",symbolAffix:"post"},mg:{singular:"Milligram",plural:"Milligrams",symbol:"mg",type:"weight",symbolAffix:"post",system:"metric"},gram:{singular:"Gram",plural:"Grams",symbol:"g",type:"weight",symbolAffix:"post",system:"metric",cousin:"oz",convert(e){return e&&e/28.3495}},kg:{singular:"Kilogram",plural:"Kilograms",symbol:"kg",type:"weight",symbolAffix:"post",system:"metric",cousin:"pound",convert(e){return e&&e/.453592}},stone:{singular:"Stone",plural:"Stones",symbol:"st",type:"weight",system:"metric"},oz:{singular:"Ounce",plural:"Ounces",symbol:"oz",type:"weight",symbolAffix:"post",symbolSpace:!0,system:"imperial",cousin:"gram",convert(e){return e&&e*28.3495}},pound:{singular:"Pound",plural:"Pounds",symbol:"lbs",type:"weight",symbolAffix:"post",symbolSpace:!0,system:"imperial",cousin:"kg",convert(e){return e&&e*.453592}},cup:{singular:"Cup",plural:"Cups",symbol:"cups",type:"volume",symbolAffix:"post",symbolSpace:!0,system:"imperial"},fluidounce:{singular:"Fluid Ounce",plural:"Fluid Ounces",symbol:"oz",type:"volume",symbolAffix:"post",symbolSpace:!0,system:"imperial",cousin:"milliliter",convert(e){return e*29.57353}},pint:{singular:"Pint",plural:"Pints",symbol:"pint",type:"volume"},deciliter:{singular:"Deciliter",plural:"Deciliters",symbol:"dL",type:"volume"},mdgl:{singular:"Blood Sugar",plural:"Blood Sugar",symbol:"mg/dl",type:"health",symbolAffix:"post",symbolSpace:!0},quart:{singular:"Quart",plural:"Quarts",symbol:"qt",type:"volume",symbolAffix:"post"},gallon:{singular:"Gallon",plural:"Gallons",symbol:"gal",type:"volume",symbolAffix:"post",symbolSpace:!0,system:"imperial",cousin:"liter",convert(e){return e!==0?e*3.78:e}},liter:{singular:"Liter",plural:"Liters",symbol:"L",type:"volume",symbolAffix:"post",symbolSpace:!1,system:"metric",cousin:"gallon",convert(e){return e!==0?e/3.78:e}},kiloliter:{singular:"Kiloliter",plural:"Kiloliters",symbol:"kl",type:"volume",symbolAffix:"post",symbolSpace:!1,system:"metric"},milliliter:{singular:"Millilitre",plural:"Millilitres",symbol:"ml",type:"volume",symbolAffix:"post",symbolSpace:!1,system:"metric"}},Lu=e=>Yr[e],Ru=(e,t,r=!0)=>{const s=[e],n=Lu(t);return n?(n.symbolAffix==="post"&&r?s.push(`${n.symbolSpace?" ":""}${n.symbol}`):n.symbolAffix==="pre"&&r&&s.unshift(`${n.symbol}${n.symbolSpace?" ":""}`),s.join(" ")):e},Uu=(e,t,r)=>{const s=Yr[t];return!s||!s.display?Ru(e,t,r):s.display(e,r)};var kt={};Object.defineProperty(kt,"__esModule",{value:!0});var Xe=kt.Md5=void 0,Pr=function(){function e(){this._dataLength=0,this._bufferLength=0,this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(t,r){return r===void 0&&(r=!1),this.onePassHasher.start().appendStr(t).end(r)},e.hashAsciiStr=function(t,r){return r===void 0&&(r=!1),this.onePassHasher.start().appendAsciiStr(t).end(r)},e._hex=function(t){var r=e.hexChars,s=e.hexOut,n,a,i,o;for(o=0;o<4;o+=1)for(a=o*8,n=t[o],i=0;i<8;i+=2)s[a+1+i]=r.charAt(n&15),n>>>=4,s[a+0+i]=r.charAt(n&15),n>>>=4;return s.join("")},e._md5cycle=function(t,r){var s=t[0],n=t[1],a=t[2],i=t[3];s+=(n&a|~n&i)+r[0]-680876936|0,s=(s<<7|s>>>25)+n|0,i+=(s&n|~s&a)+r[1]-389564586|0,i=(i<<12|i>>>20)+s|0,a+=(i&s|~i&n)+r[2]+606105819|0,a=(a<<17|a>>>15)+i|0,n+=(a&i|~a&s)+r[3]-1044525330|0,n=(n<<22|n>>>10)+a|0,s+=(n&a|~n&i)+r[4]-176418897|0,s=(s<<7|s>>>25)+n|0,i+=(s&n|~s&a)+r[5]+1200080426|0,i=(i<<12|i>>>20)+s|0,a+=(i&s|~i&n)+r[6]-1473231341|0,a=(a<<17|a>>>15)+i|0,n+=(a&i|~a&s)+r[7]-45705983|0,n=(n<<22|n>>>10)+a|0,s+=(n&a|~n&i)+r[8]+1770035416|0,s=(s<<7|s>>>25)+n|0,i+=(s&n|~s&a)+r[9]-1958414417|0,i=(i<<12|i>>>20)+s|0,a+=(i&s|~i&n)+r[10]-42063|0,a=(a<<17|a>>>15)+i|0,n+=(a&i|~a&s)+r[11]-1990404162|0,n=(n<<22|n>>>10)+a|0,s+=(n&a|~n&i)+r[12]+1804603682|0,s=(s<<7|s>>>25)+n|0,i+=(s&n|~s&a)+r[13]-40341101|0,i=(i<<12|i>>>20)+s|0,a+=(i&s|~i&n)+r[14]-1502002290|0,a=(a<<17|a>>>15)+i|0,n+=(a&i|~a&s)+r[15]+1236535329|0,n=(n<<22|n>>>10)+a|0,s+=(n&i|a&~i)+r[1]-165796510|0,s=(s<<5|s>>>27)+n|0,i+=(s&a|n&~a)+r[6]-1069501632|0,i=(i<<9|i>>>23)+s|0,a+=(i&n|s&~n)+r[11]+643717713|0,a=(a<<14|a>>>18)+i|0,n+=(a&s|i&~s)+r[0]-373897302|0,n=(n<<20|n>>>12)+a|0,s+=(n&i|a&~i)+r[5]-701558691|0,s=(s<<5|s>>>27)+n|0,i+=(s&a|n&~a)+r[10]+38016083|0,i=(i<<9|i>>>23)+s|0,a+=(i&n|s&~n)+r[15]-660478335|0,a=(a<<14|a>>>18)+i|0,n+=(a&s|i&~s)+r[4]-405537848|0,n=(n<<20|n>>>12)+a|0,s+=(n&i|a&~i)+r[9]+568446438|0,s=(s<<5|s>>>27)+n|0,i+=(s&a|n&~a)+r[14]-1019803690|0,i=(i<<9|i>>>23)+s|0,a+=(i&n|s&~n)+r[3]-187363961|0,a=(a<<14|a>>>18)+i|0,n+=(a&s|i&~s)+r[8]+1163531501|0,n=(n<<20|n>>>12)+a|0,s+=(n&i|a&~i)+r[13]-1444681467|0,s=(s<<5|s>>>27)+n|0,i+=(s&a|n&~a)+r[2]-51403784|0,i=(i<<9|i>>>23)+s|0,a+=(i&n|s&~n)+r[7]+1735328473|0,a=(a<<14|a>>>18)+i|0,n+=(a&s|i&~s)+r[12]-1926607734|0,n=(n<<20|n>>>12)+a|0,s+=(n^a^i)+r[5]-378558|0,s=(s<<4|s>>>28)+n|0,i+=(s^n^a)+r[8]-2022574463|0,i=(i<<11|i>>>21)+s|0,a+=(i^s^n)+r[11]+1839030562|0,a=(a<<16|a>>>16)+i|0,n+=(a^i^s)+r[14]-35309556|0,n=(n<<23|n>>>9)+a|0,s+=(n^a^i)+r[1]-1530992060|0,s=(s<<4|s>>>28)+n|0,i+=(s^n^a)+r[4]+1272893353|0,i=(i<<11|i>>>21)+s|0,a+=(i^s^n)+r[7]-155497632|0,a=(a<<16|a>>>16)+i|0,n+=(a^i^s)+r[10]-1094730640|0,n=(n<<23|n>>>9)+a|0,s+=(n^a^i)+r[13]+681279174|0,s=(s<<4|s>>>28)+n|0,i+=(s^n^a)+r[0]-358537222|0,i=(i<<11|i>>>21)+s|0,a+=(i^s^n)+r[3]-722521979|0,a=(a<<16|a>>>16)+i|0,n+=(a^i^s)+r[6]+76029189|0,n=(n<<23|n>>>9)+a|0,s+=(n^a^i)+r[9]-640364487|0,s=(s<<4|s>>>28)+n|0,i+=(s^n^a)+r[12]-421815835|0,i=(i<<11|i>>>21)+s|0,a+=(i^s^n)+r[15]+530742520|0,a=(a<<16|a>>>16)+i|0,n+=(a^i^s)+r[2]-995338651|0,n=(n<<23|n>>>9)+a|0,s+=(a^(n|~i))+r[0]-198630844|0,s=(s<<6|s>>>26)+n|0,i+=(n^(s|~a))+r[7]+1126891415|0,i=(i<<10|i>>>22)+s|0,a+=(s^(i|~n))+r[14]-1416354905|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~s))+r[5]-57434055|0,n=(n<<21|n>>>11)+a|0,s+=(a^(n|~i))+r[12]+1700485571|0,s=(s<<6|s>>>26)+n|0,i+=(n^(s|~a))+r[3]-1894986606|0,i=(i<<10|i>>>22)+s|0,a+=(s^(i|~n))+r[10]-1051523|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~s))+r[1]-2054922799|0,n=(n<<21|n>>>11)+a|0,s+=(a^(n|~i))+r[8]+1873313359|0,s=(s<<6|s>>>26)+n|0,i+=(n^(s|~a))+r[15]-30611744|0,i=(i<<10|i>>>22)+s|0,a+=(s^(i|~n))+r[6]-1560198380|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~s))+r[13]+1309151649|0,n=(n<<21|n>>>11)+a|0,s+=(a^(n|~i))+r[4]-145523070|0,s=(s<<6|s>>>26)+n|0,i+=(n^(s|~a))+r[11]-1120210379|0,i=(i<<10|i>>>22)+s|0,a+=(s^(i|~n))+r[2]+718787259|0,a=(a<<15|a>>>17)+i|0,n+=(i^(a|~s))+r[9]-343485551|0,n=(n<<21|n>>>11)+a|0,t[0]=s+t[0]|0,t[1]=n+t[1]|0,t[2]=a+t[2]|0,t[3]=i+t[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var r=this._buffer8,s=this._buffer32,n=this._bufferLength,a,i;for(i=0;i<t.length;i+=1){if(a=t.charCodeAt(i),a<128)r[n++]=a;else if(a<2048)r[n++]=(a>>>6)+192,r[n++]=a&63|128;else if(a<55296||a>56319)r[n++]=(a>>>12)+224,r[n++]=a>>>6&63|128,r[n++]=a&63|128;else{if(a=(a-55296)*1024+(t.charCodeAt(++i)-56320)+65536,a>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");r[n++]=(a>>>18)+240,r[n++]=a>>>12&63|128,r[n++]=a>>>6&63|128,r[n++]=a&63|128}n>=64&&(this._dataLength+=64,e._md5cycle(this._state,s),n-=64,s[0]=s[16])}return this._bufferLength=n,this},e.prototype.appendAsciiStr=function(t){for(var r=this._buffer8,s=this._buffer32,n=this._bufferLength,a,i=0;;){for(a=Math.min(t.length-i,64-n);a--;)r[n++]=t.charCodeAt(i++);if(n<64)break;this._dataLength+=64,e._md5cycle(this._state,s),n=0}return this._bufferLength=n,this},e.prototype.appendByteArray=function(t){for(var r=this._buffer8,s=this._buffer32,n=this._bufferLength,a,i=0;;){for(a=Math.min(t.length-i,64-n);a--;)r[n++]=t[i++];if(n<64)break;this._dataLength+=64,e._md5cycle(this._state,s),n=0}return this._bufferLength=n,this},e.prototype.getState=function(){var t=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[t[0],t[1],t[2],t[3]]}},e.prototype.setState=function(t){var r=t.buffer,s=t.state,n=this._state,a;for(this._dataLength=t.length,this._bufferLength=t.buflen,n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],a=0;a<r.length;a+=1)this._buffer8[a]=r.charCodeAt(a)},e.prototype.end=function(t){t===void 0&&(t=!1);var r=this._bufferLength,s=this._buffer8,n=this._buffer32,a=(r>>2)+1;this._dataLength+=r;var i=this._dataLength*8;if(s[r]=128,s[r+1]=s[r+2]=s[r+3]=0,n.set(e.buffer32Identity.subarray(a),a),r>55&&(e._md5cycle(this._state,n),n.set(e.buffer32Identity)),i<=4294967295)n[14]=i;else{var o=i.toString(16).match(/(.*?)(.{0,8})$/);if(o===null)return;var l=parseInt(o[2],16),u=parseInt(o[1],16)||0;n[14]=l,n[15]=u}return e._md5cycle(this._state,n),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();if(Xe=kt.Md5=Pr,Pr.hashStr("hello")!=="5d41402abc4b2a76b9719d911017c592")throw new Error("Md5 self test failed.");var Ot=(e,t)=>{let r=`${new Date().getTime()+Math.random()}`,s=32;if(e){if(typeof e=="string"){let n=typeof t=="number"?t:s;return r=e,Xe.hashStr(r).toString().substr(0,n)}else if(typeof e=="number")return Xe.hashStr(r).toString().substr(0,e)}else return Xe.hashStr(r).toString().substr(0,s)};const Vu=e=>{let t=0,r,s;if(e.length===0)return t;for(r=0;r<e.length;r++)s=e.charCodeAt(r),t=(t<<5)-t+s,t|=0;return t};function Hu(e){return(e||"").replace(/('|"|\?|-|\)|\(|\*|\&|\||\$|\@|\+|\#)/gi,"").trim().replace(/( )/g,"_").toLowerCase()}class It{constructor(t){f(this,"id");f(this,"tag");f(this,"label");f(this,"type");f(this,"color");f(this,"math");f(this,"ignore_zeros");f(this,"uom");f(this,"emoji");f(this,"avatar");f(this,"default");f(this,"max");f(this,"min");f(this,"maxLabel");f(this,"minLabel");f(this,"step");f(this,"score");f(this,"score_calc");f(this,"goal");f(this,"one_tap");f(this,"include");f(this,"note");f(this,"hidden");f(this,"started");f(this,"picks");f(this,"_dirty");f(this,"focus");t=t||{},this.tag=this.toTag(t.tag||""),this.tag.length?this._dirty=void 0:this._dirty=!0,this.id=t.id||Ot(),this.type=t.type||"tick",this.color=t.color||"#369DD3",this.math=t.math||"sum",this.ignore_zeros=t.ignore_zeros||!1,this.uom=t.uom||"num",this.focus=t.focus||[],this.emoji=t.emoji||null,this.avatar=t.avatar||null,this.default=t.default,this.type==="range"&&(this.max=t.max?t.max.toString():"10",this.min=t.max?t.min.toString():"1",this.step=t.step||"1",this.minLabel=t.minLabel,this.maxLabel=t.maxLabel),this.score=t.score,this.score_calc=t.score_calc,this.goal=t.goal,this.one_tap=t.one_tap===!0,this.include=t.include||"",this.note=t.note,this.hidden=t.hidden===!0,this.type==="timer"&&(this.started=t.started),this.picks=t.picks||void 0,t.label?this.label=t.label:this.label=this.displayTag()}getUID(){return Ot(this.tag)}toTrackable(t){return new be({type:"tracker",id:this.id,tracker:this,value:re(t)})}toNoteString(t=void 0){const r=[];return r.push(`#${this.tag}`),t!==void 0?(r.push(`(${t})`),this.include&&this.include.length&&r.push(` ${this.getIncluded(t)}`)):this.default&&(r.push(`(${this.default})`),this.include&&this.include.length&&(r.push(" "),r.push(` ${this.getIncluded(this.default)}`))),r.join("").trim()}getIncluded(t){let r=this.include||"";return r.search("{value}")>-1?r=r.replace(/\{value\}/gi,t||""):r=r.replace(/\*/,t||""),r.trim()}toToken(t){const r=t?`#${this.tag}(${t})`:`#${this.tag}`;return{id:this.tag,type:"tracker",raw:r,prefix:"#",value:re(t)}}displayTag(){return this.tag.replace(/_/g," ").split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}toTag(t){return Hu(t)}displayValue(t,r=!0){let s=re(t)||0;return Uu(Math.round(s*100)/100,this.uom,r)}calculateScore(t,r){return Ue(t,this,r)}displayValues(t,r=!0){const s=this.math==="sum"?R.sum(t):R.average(t);return this.displayValue(s,r)}get asObject(){return JSON.parse(JSON.stringify(this))}}function St(e){return e===!1?!1:e!=null}var Gu={emoji(e){const t=["(?:[\u2700-\u27BF]|(?:\uD83C[\uDDE6-\uDDFF]){2}|[\uD800-\uDBFF][\uDC00-\uDFFF]|[#-9]\uFE0F?\u20E3|\u3299|\u3297|\u303D|\u3030|\u24C2|\uD83C[\uDD70-\uDD71]|\uD83C[\uDD7E-\uDD7F]|\u{1F18E}|\uD83C[\uDD91-\uDD9A]|\uD83C[\uDDE6-\uDDFF]|[\uD83C[\uDE01-\uDE02]|\u{1F21A}|\u{1F22F}|[\uD83C[\uDE32-\uDE3A]|[\uD83C[\uDE50-\uDE51]|\u203C|\u2049|[\u25AA-\u25AB]|\u25B6|\u25C0|[\u25FB-\u25FE]|\xA9|\xAE|\u2122|\u2139|\u{1F004}|[\u2600-\u26FF]|\u2B05|\u2B06|\u2B07|\u2B1B|\u2B1C|\u2B50|\u2B55|\u231A|\u231B|\u2328|\u23CF|[\u23E9-\u23F3]|[\u23F8-\u23FA]|\u{1F0CF}|\u2934|\u2935|[\u2190-\u21FF])"];return!!e.match(t.join("|"))},truthy(e){return St(e)},number(e){return!isNaN(e)},url(e){try{return Boolean(new URL(e))}catch{return!1}}};class be{constructor(t){f(this,"type");f(this,"id");f(this,"person");f(this,"tracker");f(this,"context");f(this,"ctx");f(this,"value");this.type=t.type,t.type=="tracker"?(this.tracker=t.tracker instanceof It?t.tracker:new It(t.tracker),this.id=t.id||`#${(this.tracker||{}).tag}`):t.type==="person"?(this.person=t.person?t.person instanceof Ft?t.person:new Ft(t.person):void 0,this.id=t.id||"@(this.person || {}).username"):t.type==="context"&&(this.context=t.context,this.id=t.id,this.ctx=new Nr(t.ctx||this.context)),this.value=t.value}get label(){switch(this.type){case"tracker":return`${this.tracker.label||""}`;case"person":return`${this.person.displayName||""}`;case"context":return`${this.ctx.label||""}`}}get prefix(){switch(this.type){case"tracker":return"#";case"person":return"@";case"context":return"+";default:return""}}set avatar(t){this.type=="tracker"?this.tracker.avatar=t:this.type=="person"?this.person.avatar=t:this.type=="context"&&(this.ctx.avatar=t)}set emoji(t){this.type=="tracker"?this.tracker.emoji=t:this.type=="person"?this.person.emoji=t:this.type=="context"&&(this.ctx.emoji=t)}set tag(t){this.type=="tracker"?this.tracker.tag=t:this.type=="person"?this.person.username=t:this.type=="context"&&(this.ctx.tag=t)}set label(t){this.type=="tracker"?this.tracker.label=t:this.type=="person"?this.person.displayName=t:this.type=="context"&&(this.ctx.label=t)}set color(t){this.type=="tracker"?this.tracker.color=t:this.type=="person"?this.person.color=t:this.type=="context"&&(this.ctx.color=t)}get avatar(){if(this.type=="tracker")return this.tracker.avatar;if(this.type=="person")return this.person.avatar;if(this.type=="context")return this.ctx.avatar}get emoji(){if(this.type=="tracker")return this.tracker.emoji;if(this.type=="person")return this.person.emoji;if(this.type==="context")return this.ctx.emoji}get canSave(){return this.type=="tracker"?!!(this.tracker.label&&this.tracker.type&&this.tracker.tag):this.type=="person"?!!this.person.username:this.type==="context"?!!this.ctx.label:!1}get defaultValue(){switch(this.type){case"tracker":return this.tracker.default!==void 0?this.tracker.default:1;case"person":return 1;case"context":return 1}}formatValue(t,r){return this.tracker?this.tracker.displayValue(t,r):t}tallyValues(t){var s;const r=t.filter(n=>!isNaN(n));return((s=this.tracker)==null?void 0:s.math)==="mean"?R.average(r):R.sum(r)}get color(){var t,r,s;switch(this.type){case"tracker":return((t=this.tracker)==null?void 0:t.color)||Je(`#${this.tracker.tag}`);case"person":return((r=this.person)==null?void 0:r.color)||Je(`@${this.person.username}`);case"context":return((s=this.ctx)==null?void 0:s.color)||Je(`+${this.context}`);default:return Je(`unknown-${this.id}`)}}getNoteValue(t,r=!0){const s=this.tag,n=t||this.value||this.defaultValue||NaN;if(this.type=="tracker"){let a=[];return!isNaN(n)&&Gu.truthy(n)?a.push(`${s}(${n})`):a.push(`${s}`),r&&a.push(this.tracker.getIncluded(re(n))),a.join(" ")}else if(ju(n)&&this.type!=="person")return`${s}(${n})`;return s}get tag(){if(this.type=="tracker")return this.tracker.tag?`#${this.tracker.tag}`:void 0;if(this.type=="person")return this.person.username?`@${this.person.username}`:void 0;if(this.type==="context")return this.ctx.tag?`+${this.ctx.tag}`:void 0}tagWithValue(t){return t?`${this.tag}(${t})`:this.tag}}const qu=e=>{const t=_(e),r=t.format("DD").substring(0,1);return`${t.format("YYYY-MM-")}${r}`},zu=e=>{const t=mt(e),r=t.filter(s=>s.type==="generic").length;return Math.round(100*R.percentage(t.length,r))/100},Ct=(e,t={})=>{if(["tracker","person","context"].indexOf(e.type)>-1){const r=`${e.prefix}${e.id}`;let s=t[r];return s?(s.value=re(e.value),e.type=="tracker"&&s.value,s):(s||(e.type==="tracker"?(s=new It({tag:r}).toTrackable(),s.value=e.value?re(`${e.value}`):NaN,s.tracker.default=s.value):e.type==="person"?s=new Ft({username:`${e.id}`}).toTrackable():e.type==="context"&&(s=new Nr({tag:e.id,label:e.id}).toTrackable(),s.value=e.value?re(`${e.value}`):NaN)),s)}else return};class Wu{constructor(t){f(this,"_dirty");f(this,"_id");f(this,"note");f(this,"start");f(this,"end");f(this,"score");f(this,"lat");f(this,"lng");f(this,"location");f(this,"offset");f(this,"modified");f(this,"source");f(this,"pinned");f(this,"trackers");f(this,"people");f(this,"context");t=t||{},this._dirty=t._id?void 0:!0,this._id=t._id||Ot(10),this.note=(t.note||t.notes||"").trim(),this.end=t.end?new Date(t.end):new Date,this.start=t.start?new Date(t.start):new Date(this.end.getTime()-1e3),this.pinned=!!t.pinned,this.score=t.score,this.lat=t.lat||null,this.lng=t.lng||null,this.location=t.location||"",this.offset=t.offset||new Date().getTimezoneOffset(),this.modified=t.modified||!1,this.source=t.source||null}get hasNote(){return zu(this.note||"")>5}endDayjs(){return _(this.end)}startDayjs(){return _(this.start)}get elements(){return mt(this.note)}get bookId(){return qu(this.end)}get hasTodo(){return`${this.note||""}`.search(/(\[\]|\[x\])/gi)>-1}toObject(){return{_id:this._id,note:this.note,end:this.end,start:this.start,score:this.score,lat:this.lat,lng:this.lng,location:this.location,source:this.source,modified:this.modified}}hash(){return Vu([this.note,this.start,this.end,this.lat,this.lng].join(""))}isValid(){return!!(this.note.length>0||this.lat||this.lng)}calculateScore(t){return Sr(this.note,this.end,t)}setScore(t){this.score=t}addTag(t,r){return r?this.note=`${this.note} #${t}(${r})`:this.note=`${this.note} #${t}`,this.getMeta(),this}get geoType(){return{lat:this.lat,lng:this.lng,name:this.location}}hasTracker(t){return this.trackers||this.getMeta(),!!this.trackers.find(r=>r.id==t)}getTrackerValues(t){return this.trackers.filter(r=>r.id==t).map(r=>r.value)}noteTextLength(){return this.getScrubbedNote().length}getScrubbedNote(){return this.note.split(" ").filter(r=>!(r.length>1&&r.substr(0,1)=="#")).join(" ")}expand(){return this.expanded()}expanded(){return Object.assign(this,{tokens:gt.parse(this.note),duration:this.end.getTime()-this.start.getTime(),startDate:new Date(this.start),endDate:new Date(this.end)})}getTrackerValue(t,r="sum"){let s=this.getMeta().trackers.filter(n=>n.id==t).map(n=>parseFloat(`${n.value}`));return r=="sum"?R.round(R.sum(s)):R.round(R.average(s))}getTrackables(t={}){const r=this.getMeta(),s=[];return r.trackers.forEach(n=>{let a=Ct(n,t);s.push(new be(a))}),r.people.forEach(n=>{s.push(Ct(n,t))}),r.context.forEach(n=>{s.push(Ct(n,t))}),s.filter(n=>n)}getMeta(){let t=gt.parse(this.note);return Object.assign(this,{duration:this.end.getTime()-this.start.getTime(),startDate:_(this.start),endDate:_(this.end),people:t.filter(r=>r.type=="person"),context:t.filter(r=>r.type=="context"),trackers:t.filter(r=>r.type=="tracker")})}}var we={},Qe={},Br=6e4,Ku=function(t){var r=new Date(t.getTime()),s=r.getTimezoneOffset();r.setSeconds(0,0);var n=r.getTime()%Br;return s*Br+n};function Zu(e){return e instanceof Date}var jr=Zu,Nt=Ku,Ju=jr,Yt=36e5,Pt=6e4,Xu=2,Qu=/[T ]/,el=/:/,tl=/^(\d{2})$/,rl=[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],sl=/^(\d{4})/,nl=[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],al=/^-(\d{2})$/,il=/^-?(\d{3})$/,ol=/^-?(\d{2})-?(\d{2})$/,ul=/^-?W(\d{2})$/,ll=/^-?W(\d{2})-?(\d{1})$/,hl=/^(\d{2}([.,]\d*)?)$/,pl=/^(\d{2}):?(\d{2}([.,]\d*)?)$/,fl=/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,cl=/([Z+-].*)$/,dl=/^(Z)$/,yl=/^([+-])(\d{2})$/,vl=/^([+-])(\d{2}):?(\d{2})$/;function ml(e,t){if(Ju(e))return new Date(e.getTime());if(typeof e!="string")return new Date(e);var r=t||{},s=r.additionalDigits;s==null?s=Xu:s=Number(s);var n=gl(e),a=bl(n.date,s),i=a.year,o=a.restDateString,l=wl(o,i);if(l){var u=l.getTime(),h=0,c;if(n.time&&(h=Ml(n.time)),n.timezone)c=xl(n.timezone)*Pt;else{var p=u+h,m=new Date(p);c=Nt(m);var g=new Date(p);g.setDate(m.getDate()+1);var T=Nt(g)-Nt(m);T>0&&(c+=T)}return new Date(u+h+c)}else return new Date(e)}function gl(e){var t={},r=e.split(Qu),s;if(el.test(r[0])?(t.date=null,s=r[0]):(t.date=r[0],s=r[1]),s){var n=cl.exec(s);n?(t.time=s.replace(n[1],""),t.timezone=n[1]):t.time=s}return t}function bl(e,t){var r=rl[t],s=nl[t],n;if(n=sl.exec(e)||s.exec(e),n){var a=n[1];return{year:parseInt(a,10),restDateString:e.slice(a.length)}}if(n=tl.exec(e)||r.exec(e),n){var i=n[1];return{year:parseInt(i,10)*100,restDateString:e.slice(i.length)}}return{year:null}}function wl(e,t){if(t===null)return null;var r,s,n,a;if(e.length===0)return s=new Date(0),s.setUTCFullYear(t),s;if(r=al.exec(e),r)return s=new Date(0),n=parseInt(r[1],10)-1,s.setUTCFullYear(t,n),s;if(r=il.exec(e),r){s=new Date(0);var i=parseInt(r[1],10);return s.setUTCFullYear(t,0,i),s}if(r=ol.exec(e),r){s=new Date(0),n=parseInt(r[1],10)-1;var o=parseInt(r[2],10);return s.setUTCFullYear(t,n,o),s}if(r=ul.exec(e),r)return a=parseInt(r[1],10)-1,Lr(t,a);if(r=ll.exec(e),r){a=parseInt(r[1],10)-1;var l=parseInt(r[2],10)-1;return Lr(t,a,l)}return null}function Ml(e){var t,r,s;if(t=hl.exec(e),t)return r=parseFloat(t[1].replace(",",".")),r%24*Yt;if(t=pl.exec(e),t)return r=parseInt(t[1],10),s=parseFloat(t[2].replace(",",".")),r%24*Yt+s*Pt;if(t=fl.exec(e),t){r=parseInt(t[1],10),s=parseInt(t[2],10);var n=parseFloat(t[3].replace(",","."));return r%24*Yt+s*Pt+n*1e3}return null}function xl(e){var t,r;return t=dl.exec(e),t?0:(t=yl.exec(e),t?(r=parseInt(t[2],10)*60,t[1]==="+"?-r:r):(t=vl.exec(e),t?(r=parseInt(t[2],10)*60+parseInt(t[3],10),t[1]==="+"?-r:r):0))}function Lr(e,t,r){t=t||0,r=r||0;var s=new Date(0);s.setUTCFullYear(e,0,4);var n=s.getUTCDay()||7,a=t*7+r+1-n;return s.setUTCDate(s.getUTCDate()+a),s}var et=ml,Al=et;function Dl(e){var t=Al(e);return t.setHours(0,0,0,0),t}var Bt=Dl,Rr=Bt,Ur=6e4,$l=864e5;function _l(e,t){var r=Rr(e),s=Rr(t),n=r.getTime()-r.getTimezoneOffset()*Ur,a=s.getTime()-s.getTimezoneOffset()*Ur;return Math.round((n-a)/$l)}var Tl=_l,Vr=et;function El(e,t){var r=Vr(e),s=r.getTime(),n=Vr(t),a=n.getTime();return s<a?-1:s>a?1:0}var Fl=El,Hr=et,kl=Tl,Gr=Fl;function Ol(e,t){var r=Hr(e),s=Hr(t),n=Gr(r,s),a=Math.abs(kl(r,s));r.setDate(r.getDate()-n*a);var i=Gr(r,s)===-n;return n*(a-i)}var Il=Ol,J={},Sl=et;function Cl(e,t){var r=Sl(e),s=Number(t);return r.setDate(r.getDate()+s),r}var qr=Cl,Nl=qr;function Yl(e,t){var r=Number(t);return Nl(e,-r)}var zr=Yl,Pl=jr;function Bl(e){if(Pl(e))return!isNaN(e);throw new TypeError(toString.call(e)+" is not an instance of Date")}var jl=Bl;Object.defineProperty(J,"__esModule",{value:!0}),J.getDatesParameter=J.sortDates=J.filterInvalidDates=J.relativeDates=void 0;var Ll=Bt,je=tt(Ll),Rl=zr,Ul=tt(Rl),Vl=qr,Hl=tt(Vl),Gl=jl,ql=tt(Gl);function tt(e){return e&&e.__esModule?e:{default:e}}J.relativeDates=function(){return{today:(0,je.default)(new Date),yesterday:(0,je.default)((0,Ul.default)(new Date,1)),tomorrow:(0,je.default)((0,Hl.default)(new Date,1))}},J.filterInvalidDates=function(t){return t.filter(function(r){return(0,ql.default)(new Date(r))?new Date(r):console.error("The date '"+r+"' is not in a valid date format and date-streaks is ignoring it. Browsers do not consistently support this and this package's results may fail. Verify the array of dates you're passing to date-streaks are all valid date strings. http://momentjs.com/docs/#/parsing/string/")})},J.sortDates=function(t){return t.sort(function(r,s){return(0,je.default)(s)-(0,je.default)(r)}).reverse()},J.getDatesParameter=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Array.isArray(t))return t;var r=t.dates;return r||[]},Object.defineProperty(Qe,"__esModule",{value:!0});var zl=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Wl=Il,rt=Kl(Wl),st=J;function Kl(e){return e&&e.__esModule?e:{default:e}}function Zl(e,t){var r={};for(var s in e)t.indexOf(s)>=0||!Object.prototype.hasOwnProperty.call(e,s)||(r[s]=e[s]);return r}function Jl(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}function Xl(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,st.getDatesParameter)(e),r=(0,st.relativeDates)(),s=r.today,n=r.yesterday,a=(0,st.filterInvalidDates)(t),i=(0,st.sortDates)(a),o=i.reduce(function(u,h,c){var p=new Date(h),m=i[c+1]?new Date(i[c+1]):p,g=(0,rt.default)(m,p),T=u.isToday||(0,rt.default)(h,s)===0,B=u.isYesterday||(0,rt.default)(h,n)===0,j=u.isInFuture||(0,rt.default)(s,h)<0;return g===0?T&&(u.todayInStreak=!0):g===1?++u.streaks[u.streaks.length-1]:u.streaks.push(1),zl({},u,{longestStreak:Math.max.apply(Math,Jl(u.streaks)),withinCurrentStreak:u.isToday||u.isYesterday||u.isInFuture||T||B||j,currentStreak:T||B||j?u.streaks[u.streaks.length-1]:0,isInFuture:j,isYesterday:B,isToday:T})},{currentStreak:0,longestStreak:0,streaks:[1],todayInStreak:!1,withinCurrentStreak:!1,isInFuture:!1,isToday:!1,isYesterday:!1});o.isToday,o.isYesterday,o.isInFuture;var l=Zl(o,["isToday","isYesterday","isInFuture"]);return l}Qe.default=Xl;var jt={};Object.defineProperty(jt,"__esModule",{value:!0});var Wr=J,Ql=Qe,eh=th(Ql);function th(e){return e&&e.__esModule?e:{default:e}}function Kr(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}function rh(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=(0,Wr.getDatesParameter)(e);if(t.length===0)return[];var r=(0,eh.default)({dates:t}),s=r.streaks,n=s===void 0?[]:s,a=[].concat(Kr((0,Wr.sortDates)(t)));return n.reduce(function(i,o){var l=void 0,u=void 0,h=a.slice(0,o);return a.splice(0,o),h&&h.length>1?(l=new Date(h[0]),u=new Date(h[h.length-1])):(l=new Date(h[0]),u=null),[].concat(Kr(i),[{start:l,end:u,duration:o}])},[]).reverse()}jt.default=rh;var Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});var sh=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},nh=Bt,Zr=Jr(nh),ah=zr,ih=Jr(ah),oh=J;function Jr(e){return e&&e.__esModule?e:{default:e}}function uh(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lh(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}else return Array.from(e)}var hh=function(t){var r=t.dates,s=r===void 0?[]:r,n=t.length,a=n===void 0?7:n,i=t.endDate,o=i===void 0?new Date:i,l=[].concat(lh(Array(a))).map(function(c,p){return(0,Zr.default)((0,ih.default)(o,p))}),u=(0,oh.sortDates)(s).map(function(c){return(0,Zr.default)(c).getTime()}),h=l.reduce(function(c,p){return c=sh({},c,uh({},p,u.includes(p.getTime()))),c},{});return h};Lt.default=hh,Object.defineProperty(we,"__esModule",{value:!0}),we.trackRecord=we.streakRanges=Xr=we.summary=void 0;var ph=Qe,fh=Rt(ph),ch=jt,dh=Rt(ch),yh=Lt,vh=Rt(yh);function Rt(e){return e&&e.__esModule?e:{default:e}}var Xr=we.summary=fh.default;we.streakRanges=dh.default,we.trackRecord=vh.default;class he{constructor(t){f(this,"trackable");f(this,"values");f(this,"hours");f(this,"dates");f(this,"positivity");f(this,"displayValue");f(this,"groupedBy");f(this,"logs");f(this,"unitScores");f(this,"noteScores");this.trackable=new be(t.trackable),this.values=t.values||[],this.dates=t.dates||[],this.displayValue=t.displayValue,this.hours=t.hours||[],this.groupedBy=t.groupedBy,this.logs=t.logs||[],this.positivity=t.positivity||[]}getTotalScore(t){return R.sum((this.logs||[]).map(r=>Sr(r.note,r.end,t)))}get middleDate(){return new Date((this.dates[0].toDate().getTime()+this.dates[this.dates.length-1].toDate().getTime())/2)}get firstDate(){return this.logs.sort((t,r)=>t.end>r.end?1:-1)[0].end}get lastDate(){return this.logs.sort((t,r)=>t.end<r.end?1:-1)[0].end}groupBy(t,r,s=!1){const n=t;let a={};for(let h=0;h<this.dates.length;h++){let c=this.dates[h],p=_(c).format(r);a[p]=a[p]||{key:p,values:[],date:c,format:r};let m=isNaN(this.values[h])?NaN:this.values[h];a[p].values.push(m)}const i=Object.keys(a).map(h=>{let c=a[h].values.filter(p=>!isNaN(p)).length;return{dates:a[h].date,values:c>0?this.trackable.tallyValues(a[h].values):NaN}}),o=i.map(h=>h.values),l=i.map(h=>h.dates),u=(this.logs||[]).map(h=>h.score);return new he({trackable:this.trackable,displayValue:this.displayValue,values:o,dates:l,groupedBy:n,noteScores:u,positivity:o.map((h,c)=>{var p;return s?0:this.trackable.tracker?(p=this.trackable.tracker)==null?void 0:p.calculateScore(h,l[c].toDate()):0})})}get total(){return this.trackable.tallyValues(this.values)}formatValue(t,r=!0){return this.trackable.tracker?this.trackable.tracker.displayValue(t,r):`${t}`}get totalDisplay(){try{return`${this.trackable.formatValue(this.total)}`}catch{return""}}get totalFormatted(){return this.totalDisplay}get totalOnly(){try{return`${this.trackable.formatValue(this.total,!1)}`}catch{return""}}get average(){return R.average(this.values.filter(t=>!isNaN(t)))}get averaged(){const t=new he(this),r=t.values.filter(n=>!isNaN(n)),s=R.max(r);return t.values=t.values.map(n=>isNaN(n)?n:R.percentage(s,n)),t}getMinMax(t){let r;t=="min"?r=R.min(this.values):r=R.max(this.values);let s=this.values.indexOf(r);if(s>-1)return{date:this.dates[s],value:this.values[s],display:this.trackable.formatValue(this.values[s])}}get max(){return this.getMinMax("max")}get min(){return this.getMinMax("min")}get byDay(){return this.groupBy("day","YYYY-MM-DD")}get streakSummary(){return Xr({dates:this.dates.map(t=>t.startOf("day").toDate())})}truncate(t,r){const s=[],n=[];return this.dates.map((a,i)=>{a.unix()<=r.unix()&&a.unix()>=t.unix()&&(s.push(this.values[i]),n.push(this.dates[i]))}),new he({trackable:this.trackable,displayValue:this.displayValue,values:s,dates:n,groupedBy:this.groupedBy})}reverse(){let t=new he(this);return t.values=[...this.values].reverse(),t.dates=[...this.dates].reverse(),t.positivity=[...this.positivity].reverse(),t}backfill(t,r){if(!t&&!this.dates.length)return new he({trackable:this.trackable,displayValue:this.displayValue,values:this.values,dates:this.dates,groupedBy:this.groupedBy});const s=_(t||this.dates[0]),n=_(r||this.dates[this.dates.length-1]);let a,i;i=s.toDate().getTime()>n.toDate().getTime()?s:n,a=s.toDate().getTime()<n.toDate().getTime()?s:n;const o=this.groupedBy||"day",l=ot(a.toDate(),i.toDate(),o),u=l.map(p=>_(p.date)),h=l.map(()=>NaN),c=(as[o]||{}).keyFormat;if(!c)throw new Error(`Could not find calendar groupby ${o}`);return u.forEach((p,m)=>{const g=this.dates.findIndex(T=>_(T).format(c)===_(p).format(c));g>-1&&(h[m]=this.values[g])}),new he({trackable:this.trackable,displayValue:this.displayValue,values:h,dates:u,groupedBy:o,positivity:h.map((p,m)=>{var g;return this.trackable.tracker?(g=this.trackable.tracker)==null?void 0:g.calculateScore(p,u[m].toDate()):0})})}}function mh(e,t={}){let r={};return e.sort((s,n)=>s.end>n.end?1:-1).forEach(s=>{r=gh(s,r,t)}),r}function gh(e,t={},r={}){const s=t;return e.getTrackables(r.trackables||{}).forEach(n=>{const a=s[n.tag],i=parseInt(_(new Date(e.end)).format("HH"));{if(a){const o=St(n.value)?re(`${n.value||0}`):1,l=n.tracker?Ue(o,n.tracker):0;if(s[n.tag]){const u=s[n.tag];u.values.push(o),u.hours.push(i),u.logs.push(e),u.positivity.push(l),u.dates.push(e.endDayjs())}}else{const o=St(n.value)?re(`${n.value||0}`):1,l=n.tracker?Ue(o,n.tracker):0,u=new he({trackable:n,values:[o],hours:[i],dates:[e.endDayjs()],logs:[e],positivity:[l]});s[n.tag]=s[n.tag]||u}s[n.tag].displayValue=n.formatValue(n.tallyValues(s[n.tag].values))}}),s}onmessage=e=>{const t=e.data,r=t.logs.sort((o,l)=>o.end>l.end?1:-1).map(o=>new Wu(o)),s=t.knownTrackables;Object.keys(s).map(o=>{s[o]=new be(s[o])});const n=t.includeTrackables.map(o=>new be(o));console.log("Worker CSV Columsn",{logs:r,knownTrackables:s,trackableArray:n});const a=["date"],i=[];if(r.length){const o=_(r[0].end),l=_(r[r.length-1].end),u=ot(o.toDate(),l.toDate(),"day"),h=mh(r,{trackables:s});n.forEach(c=>{a.push(c.tag)}),u.forEach(c=>{const m=[_(c.date).format("YYYY-MM-DD")];i.push(m)}),n.forEach((c,p)=>{const m=h[c.tag];if(m){let g=m.backfill(u[0].date,u[u.length-1].date).byDay,T=a.indexOf(g.trackable.tag);g.dates.forEach((B,j)=>{const $=i.findIndex(N=>N[0]===B.format("YYYY-MM-DD"));if($>-1&&T>-1){const N=g.values[j];i[$][T]=isNaN(N)?0:N}})}})}postMessage([a,...i.reverse()])}})();
